<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seminario de Investigación</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM CDNs (Deben cargarse primero) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Firebase CDNs (Versiones compat para acceso global) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <!-- Iconos simples con CSS -->
    <!-- Babel CDN (Para transpilar JSX en el navegador) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Firebase Configuration (load before main script) -->
    <script src="firebase-config.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #f9fafb;
            --bg-secondary: #ffffff;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --border-color: #e5e7eb;
            --accent-color: #4D96FF;
            --success-color: #10b981;
            --error-color: #ef4444;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        [data-theme="dark"] {
            --bg-primary: #111827;
            --bg-secondary: #1f2937;
            --text-primary: #f9fafb;
            --text-secondary: #d1d5db;
            --border-color: #374151;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.3), 0 1px 2px 0 rgba(0, 0, 0, 0.2);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2);
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        .spinner {
            border: 4px solid rgba(77, 150, 255, 0.2);
            border-left-color: var(--accent-color);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @keyframes slideDown {
            from { opacity: 0; max-height: 0; }
            to { opacity: 1; max-height: 1000px; }
        }
        
        @keyframes slideUp {
            from { opacity: 1; max-height: 1000px; }
            to { opacity: 0; max-height: 0; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .animate-slideDown { animation: slideDown 0.3s ease-out; }
        .animate-fadeIn { animation: fadeIn 0.5s ease-out; }
        .animate-pulse { animation: pulse 2s infinite; }
        
        .card {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }
        
        .card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }
        
        .progress-bar {
            background-color: var(--border-color);
            border-radius: 9999px;
            overflow: hidden;
        }
        
        .progress-fill {
            background: linear-gradient(90deg, var(--accent-color), var(--success-color));
            height: 100%;
            border-radius: 9999px;
            transition: width 0.5s ease;
        }
        
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        
        .badge-earned {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }
        
        .badge-pending {
            background-color: rgba(107, 114, 128, 0.1);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }
        
        .input-field {
            background-color: var(--bg-secondary);
            border: 2px solid var(--border-color);
            color: var(--text-primary);
            transition: all 0.2s ease;
        }
        
        .input-field:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(77, 150, 255, 0.1);
        }
        
        .input-field.error {
            border-color: var(--error-color);
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
        }
        
        .input-field.success {
            border-color: var(--success-color);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            font-weight: 600;
            transition: all 0.2s ease;
            cursor: pointer;
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--accent-color), #3b82f6);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-secondary {
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
        }
        
        .btn-secondary:hover {
            border-color: var(--accent-color);
            color: var(--accent-color);
        }
        
        .theme-toggle {
            background-color: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 9999px;
            padding: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .theme-toggle:hover {
            border-color: var(--accent-color);
        }
        
        .toast {
            position: fixed;
            top: 1rem;
            right: 1rem;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            color: white;
            font-weight: 600;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }
        
        .toast-success { background-color: var(--success-color); }
        .toast-error { background-color: var(--error-color); }
        
        .chevron {
            transition: transform 0.3s ease;
            display: inline-block;
        }
        
        .chevron.rotate-90 {
            transform: rotate(90deg);
        }
        
        .prose table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            background-color: var(--bg-secondary);
        }
        
        .prose th, .prose td {
            border: 1px solid var(--border-color);
            padding: 0.75rem;
            text-align: left;
        }
        
        .prose th {
            background-color: var(--bg-primary);
            font-weight: 600;
        }
        
        .prose ul.list-disc, .prose ul.list-circle {
            padding-left: 1.5rem;
        }
        
        .prose ul.list-circle li {
            list-style-type: circle;
        }
        
        @media (max-width: 768px) {
            .card {
                margin: 0.5rem;
                padding: 1rem;
            }
            
            .btn {
                padding: 0.5rem 1rem;
                font-size: 0.875rem;
            }
            
            .toast {
                left: 1rem;
                right: 1rem;
                top: auto;
                bottom: 1rem;
            }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">
    <div id="root"></div>

    <!-- Todo el código React y la lógica de la aplicación van aquí, después de cargar todas las librerías -->
    <script type="text/babel">
        // Las librerías Firebase compat se acceden directamente desde el objeto global firebase
        
        // Sistema de notificaciones Toast
        const ToastContext = React.createContext();
        
        function ToastProvider({ children }) {
            const [toasts, setToasts] = React.useState([]);
            
            const showToast = (message, type = 'success') => {
                const id = Date.now();
                setToasts(prev => [...prev, { id, message, type }]);
                setTimeout(() => {
                    setToasts(prev => prev.filter(toast => toast.id !== id));
                }, 3000);
            };
            
            return React.createElement(ToastContext.Provider, { value: { showToast } }, [
                children,
                React.createElement('div', { key: 'toasts' }, 
                    toasts.map(toast => 
                        React.createElement('div', {
                            key: toast.id,
                            className: `toast toast-${toast.type}`
                        }, toast.message)
                    )
                )
            ]);
        }
        
        // Hook para usar toast
        const useToast = () => React.useContext(ToastContext);
        
        // Hook para tema oscuro/claro
        function useTheme() {
            const [theme, setTheme] = React.useState(() => 
                localStorage.getItem('theme') || 'light'
            );
            
            React.useEffect(() => {
                document.documentElement.setAttribute('data-theme', theme);
                localStorage.setItem('theme', theme);
            }, [theme]);
            
            const toggleTheme = () => {
                setTheme(prev => prev === 'light' ? 'dark' : 'light');
            };
            
            return { theme, toggleTheme };
        }
        
        // Componente Toggle de Tema
        function ThemeToggle() {
            const { theme, toggleTheme } = useTheme();
            return React.createElement('button', {
                className: 'theme-toggle',
                onClick: toggleTheme,
                title: `Cambiar a tema ${theme === 'light' ? 'oscuro' : 'claro'}`
            }, theme === 'light' ? '🌙' : '☀️');
        }
        
        // Iconos mejorados
        const Lock = ({ className = '' }) => React.createElement('span', { className }, '🔒');
        const User = ({ className = '' }) => React.createElement('span', { className }, '👤');
        const LogOut = ({ className = '' }) => React.createElement('span', { className }, '🚪');
        const Loader2 = ({ className = '' }) => React.createElement('div', { className: `spinner ${className}` });
        const ChevronRight = ({ className = '' }) => React.createElement('span', { className }, '▶');
        const CheckCircle = ({ className = '' }) => React.createElement('span', { className }, '✅');
        const Award = ({ className = '' }) => React.createElement('span', { className }, '🏆');
        const Eye = ({ className = '' }) => React.createElement('span', { className }, '👁');
        const EyeOff = ({ className = '' }) => React.createElement('span', { className }, '🙈');

        // Contexto para el usuario y la base de datos
        const AuthContext = React.createContext(null);

        // Componente para el spinner de carga mejorado
        const LoadingSpinner = () => (
          <div className="flex justify-center items-center py-8 animate-fadeIn">
            <div className="spinner"></div>
            <p className="ml-3" style={{color: 'var(--text-secondary)'}}>Cargando...</p>
          </div>
        );
        
        // Componente de barra de progreso
        function ProgressBar({ current, total, className = '' }) {
            const percentage = Math.round((current / total) * 100);
            return React.createElement('div', { className: `w-full ${className}` }, [
                React.createElement('div', {
                    key: 'bar',
                    className: 'progress-bar h-3 mb-2'
                }, React.createElement('div', {
                    className: 'progress-fill',
                    style: { width: `${percentage}%` }
                })),
                React.createElement('div', {
                    key: 'text',
                    className: 'flex justify-between text-sm',
                    style: { color: 'var(--text-secondary)' }
                }, [
                    React.createElement('span', { key: 'progress' }, `${current} de ${total} semanas`),
                    React.createElement('span', { key: 'percent' }, `${percentage}%`)
                ])
            ]);
        }
        
        // Dashboard de badges con funcionalidad para otorgar badges
        function BadgesDashboard({ courseWeeks, userData, onEarnBadge }) {
            const earnedBadges = userData?.badgesEarned || [];
            const totalBadges = courseWeeks.length;
            
            return React.createElement('div', {
                className: 'card rounded-xl p-6 mb-6 animate-fadeIn'
            }, [
                React.createElement('h3', {
                    key: 'title',
                    className: 'text-xl font-bold mb-4 flex items-center gap-2'
                }, [React.createElement(Award), 'Tus Badges']),
                React.createElement(ProgressBar, {
                    key: 'progress',
                    current: earnedBadges.length,
                    total: totalBadges,
                    className: 'mb-4'
                }),
                React.createElement('div', {
                    key: 'badges',
                    className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3'
                }, courseWeeks.map((week, index) => {
                    const hasEarned = earnedBadges.includes(week.badge);
                    const canEarn = !hasEarned && (week.week === 1 || earnedBadges.includes(courseWeeks[index - 1]?.badge));
                    
                    return React.createElement('div', {
                        key: week.week,
                        className: `badge ${hasEarned ? 'badge-earned' : canEarn ? 'badge-pending cursor-pointer hover:scale-105' : 'badge-pending opacity-50'} justify-between transition-all`,
                        onClick: canEarn ? () => onEarnBadge(week.badge) : undefined,
                        title: canEarn ? 'Haz clic para obtener este badge' : hasEarned ? 'Badge obtenido' : 'Completa la semana anterior primero'
                    }, [
                        React.createElement('span', { key: 'text' }, week.badge),
                        hasEarned ? React.createElement(CheckCircle, { key: 'icon' }) : React.createElement('span', { key: 'week' }, `S${week.week}`)
                    ]);
                }))
            ]);
        }

        // Componente de campo de entrada mejorado
        function InputField({ label, type = 'text', value, onChange, required = false, placeholder, error, success }) {
            const [showPassword, setShowPassword] = React.useState(false);
            const inputType = type === 'password' && showPassword ? 'text' : type;
            
            return React.createElement('div', { className: 'mb-4' }, [
                React.createElement('label', {
                    key: 'label',
                    className: 'block text-sm font-bold mb-2',
                    style: { color: 'var(--text-primary)' }
                }, label),
                React.createElement('div', { key: 'input-container', className: 'relative' }, [
                    React.createElement('input', {
                        key: 'input',
                        className: `input-field w-full py-3 px-4 rounded-lg focus:outline-none ${error ? 'error' : success ? 'success' : ''}`,
                        type: inputType,
                        placeholder,
                        value,
                        onChange,
                        required
                    }),
                    type === 'password' && React.createElement('button', {
                        key: 'toggle',
                        type: 'button',
                        className: 'absolute right-3 top-1/2 transform -translate-y-1/2 text-lg',
                        onClick: () => setShowPassword(!showPassword)
                    }, showPassword ? React.createElement(EyeOff) : React.createElement(Eye))
                ]),
                error && React.createElement('p', {
                    key: 'error',
                    className: 'text-sm mt-1',
                    style: { color: 'var(--error-color)' }
                }, error)
            ]);
        }
        
        // Componente de Autenticación mejorado
        function AuthPage({ firebaseApp }) {
            const toast = useToast();
            const auth = firebase.auth();
            const db = firebase.firestore();
            const [isLogin, setIsLogin] = React.useState(true);
            const [email, setEmail] = React.useState('');
            const [password, setPassword] = React.useState('');
            const [fullName, setFullName] = React.useState('');
            const [errors, setErrors] = React.useState({});
            const [loading, setLoading] = React.useState(false);
            
            const validateEmail = (email) => {
                const studentPattern = /^[a-zA-Z0-9._%+-]+@icesi\.edu\.co$/;
                const professorPattern = /^[a-zA-Z0-9._%+-]+@u\.icesi\.edu\.co$/;
                return studentPattern.test(email) || professorPattern.test(email);
            };

            const isProfessor = (email) => {
                return email.endsWith('@u.icesi.edu.co');
            };
            
            const validateField = (name, value) => {
                const newErrors = { ...errors };
                
                switch (name) {
                    case 'email':
                        if (!value) newErrors.email = 'El correo es requerido';
                        else if (!validateEmail(value)) newErrors.email = 'Usa tu correo institucional (@icesi.edu.co o @u.icesi.edu.co)';
                        else delete newErrors.email;
                        break;
                    case 'password':
                        if (!value) newErrors.password = 'La contraseña es requerida';
                        else if (value.length < 6) newErrors.password = 'Mínimo 6 caracteres';
                        else delete newErrors.password;
                        break;
                    case 'fullName':
                        if (!isLogin && !value) newErrors.fullName = 'El nombre es requerido';
                        else delete newErrors.fullName;
                        break;
                }
                
                setErrors(newErrors);
                return Object.keys(newErrors).length === 0;
            };

            const handleAuth = async (e) => {
                e.preventDefault();
                setLoading(true);

                if (!validateEmail(email)) {
                    toast.showToast('Usa tu correo institucional', 'error');
                    setLoading(false);
                    return;
                }

                try {
                    console.log('Intentando autenticación...', isLogin ? 'Login' : 'Registro');
                    if (isLogin) {
                        const result = await auth.signInWithEmailAndPassword(email, password);
                        console.log('Login exitoso:', result.user.uid);
                    } else {
                        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                        const user = userCredential.user;
                        console.log('Registro exitoso:', user.uid);
                        
                        const appId = 'seminario-investigacion-app'; 
                        const userDocRef = db.doc(`artifacts/${appId}/users/${user.uid}`);
                        
                        const userData = {
                            email: email,
                            fullName: fullName,
                            userType: isProfessor(email) ? 'professor' : 'student',
                            createdAt: new Date()
                        };

                        if (!isProfessor(email)) {
                            userData.badgesEarned = [];
                            userData.lastBadgeEarned = null;
                        }
                        
                        await userDocRef.set(userData);
                        console.log('Datos de usuario guardados en Firestore');
                    }
                    console.log('Autenticación completada exitosamente');
                    toast.showToast(
                        isLogin ? '¡Bienvenido de vuelta!' : '¡Cuenta creada exitosamente!',
                        'success'
                    );
                    setErrors({});
                } catch (err) {
                    console.error("Error de autenticación:", err.code, err.message);
                    let errorMessage;
                    switch (err.code) {
                        case 'auth/invalid-email':
                            errorMessage = 'El correo electrónico no tiene un formato válido.';
                            break;
                        case 'auth/user-disabled':
                            errorMessage = 'Tu cuenta ha sido deshabilitada.';
                            break;
                        case 'auth/user-not-found':
                            errorMessage = 'Usuario no encontrado. Verifica tu correo o crea una cuenta.';
                            break;
                        case 'auth/wrong-password':
                            errorMessage = 'Contraseña incorrecta.';
                            break;
                        case 'auth/email-already-in-use':
                            errorMessage = 'Este correo ya está registrado.';
                            break;
                        case 'auth/weak-password':
                            errorMessage = 'La contraseña es demasiado débil. Debe tener al menos 6 caracteres.';
                            break;
                        default:
                            errorMessage = 'Error de autenticación. Por favor, intenta de nuevo.';
                    }
                    toast.showToast(errorMessage, 'error');
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="min-h-screen flex items-center justify-center p-4" style={{backgroundColor: 'var(--bg-primary)'}}>
                    <div className="card rounded-2xl p-8 w-full max-w-md animate-fadeIn">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-3xl font-bold" style={{color: 'var(--text-primary)'}}>
                                {isLogin ? 'Iniciar Sesión' : 'Crear Cuenta'}
                            </h2>
                            <ThemeToggle />
                        </div>
                        
                        <form onSubmit={handleAuth}>
                            <InputField
                                label="Correo Institucional"
                                type="email"
                                placeholder="correo@icesi.edu.co"
                                value={email}
                                onChange={(e) => {
                                    setEmail(e.target.value);
                                    validateField('email', e.target.value);
                                }}
                                error={errors.email}
                                success={email && !errors.email}
                                required
                            />
                            
                            {!isLogin && (
                                <InputField
                                    label="Nombre Completo"
                                    placeholder="Tu Nombre Completo"
                                    value={fullName}
                                    onChange={(e) => {
                                        setFullName(e.target.value);
                                        validateField('fullName', e.target.value);
                                    }}
                                    error={errors.fullName}
                                    success={fullName && !errors.fullName}
                                    required={!isLogin}
                                />
                            )}
                            
                            <InputField
                                label="Contraseña"
                                type="password"
                                placeholder="Mínimo 6 caracteres"
                                value={password}
                                onChange={(e) => {
                                    setPassword(e.target.value);
                                    validateField('password', e.target.value);
                                }}
                                error={errors.password}
                                success={password && !errors.password}
                                required
                            />
                            
                            <div className="flex flex-col gap-4 mt-6">
                                <button
                                    className="btn btn-primary w-full"
                                    type="submit"
                                    disabled={loading || Object.keys(errors).length > 0}
                                >
                                    {loading && <Loader2 className="w-5 h-5" />}
                                    {isLogin ? 'Iniciar Sesión' : 'Registrarse'}
                                </button>
                                
                                <button
                                    className="btn btn-secondary w-full"
                                    type="button"
                                    onClick={() => {
                                        setIsLogin(!isLogin);
                                        setErrors({});
                                        setStudentCode('');
                                        setPassword('');
                                        setFullName('');
                                    }}
                                >
                                    {isLogin ? '¿No tienes cuenta? Regístrate' : '¿Ya tienes cuenta? Inicia Sesión'}
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }

        // Componente de Tarjeta de Semana del Curso mejorado
        function CourseWeek({ weekNumber, title, content, badgeName, isUnlocked, hasBadge }) {
            const [isExpanded, setIsExpanded] = React.useState(false);

            return (
                <div className={`card rounded-xl p-6 mb-6 animate-fadeIn transition-all duration-300 ${
                    isUnlocked ? 'border-l-4' : 'border-l-4 opacity-75'
                }`} style={{
                    borderLeftColor: isUnlocked ? 'var(--accent-color)' : 'var(--border-color)'
                }}>
                    <div className="mb-4">
                        <h3 className="text-xl font-bold mb-3" style={{color: 'var(--text-primary)'}}>
                            Semana {weekNumber}: {title}
                        </h3>
                        <div className="flex justify-between items-center">
                            <span className={`badge ${
                                hasBadge ? 'badge-earned' : 'badge-pending'
                            } flex items-center gap-2`}>
                                {hasBadge ? <CheckCircle /> : <Award />}
                                {hasBadge ? 'Badge Obtenido' : badgeName}
                            </span>
                            {isUnlocked ? (
                                <button
                                    onClick={() => setIsExpanded(!isExpanded)}
                                    className="btn-secondary p-3 rounded-full transition-all duration-200 hover:scale-105"
                                    aria-expanded={isExpanded}
                                    aria-controls={`week-content-${weekNumber}`}
                                    title={isExpanded ? 'Contraer contenido' : 'Expandir contenido'}
                                >
                                    <span className={`chevron ${isExpanded ? 'rotate-90' : ''}`}>▶</span>
                                </button>
                            ) : (
                                <div className="p-3 rounded-full" style={{backgroundColor: 'var(--bg-primary)'}}>
                                    <Lock className="opacity-50" />
                                </div>
                            )}
                        </div>
                    </div>
                    
                    {!isUnlocked && (
                        <div className="flex items-center gap-2 p-4 rounded-lg" style={{
                            backgroundColor: 'var(--bg-primary)',
                            color: 'var(--text-secondary)'
                        }}>
                            <Lock />
                            <p className="italic">
                                Contenido bloqueado. Necesitas el badge de la semana anterior para desbloquear.
                            </p>
                        </div>
                    )}
                    
                    {isUnlocked && isExpanded && (
                        <div 
                            id={`week-content-${weekNumber}`} 
                            className="mt-6 prose max-w-none animate-slideDown"
                            style={{color: 'var(--text-primary)'}}
                        >
                            {content}
                        </div>
                    )}
                </div>
            );
        }

        // Componente de administración para profesores
        function AdminDashboard({ currentUser }) {
            const auth = firebase.auth();
            const db = firebase.firestore();
            const toast = useToast();
            const [students, setStudents] = React.useState([]);
            const [userData, setUserData] = React.useState(null);
            const [loading, setLoading] = React.useState(true);
            const appId = 'seminario-investigacion-app';

            React.useEffect(() => {
                loadUserData();
                loadStudents();
            }, []);

            const loadUserData = async () => {
                try {
                    const userDoc = await db.doc(`artifacts/${appId}/users/${currentUser.uid}`).get();
                    if (userDoc.exists) {
                        setUserData(userDoc.data());
                    }
                } catch (error) {
                    console.error('Error cargando datos del profesor:', error);
                }
            };

            const loadStudents = async () => {
                try {
                    const snapshot = await db.collection('artifacts').doc(appId)
                        .collection('users')
                        .where('userType', '==', 'student')
                        .get();
                    
                    const studentsData = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    
                    setStudents(studentsData);
                } catch (error) {
                    console.error('Error cargando estudiantes:', error);
                    toast.showToast('Error cargando estudiantes', 'error');
                } finally {
                    setLoading(false);
                }
            };

            const assignBadge = async (studentId, badgeName) => {
                try {
                    const student = students.find(s => s.id === studentId);
                    if (!student) return;

                    const updatedBadges = [...(student.badgesEarned || []), badgeName];
                    
                    await db.doc(`artifacts/${appId}/users/${studentId}`).update({
                        badgesEarned: updatedBadges,
                        lastBadgeEarned: new Date()
                    });
                    
                    setStudents(prev => prev.map(s => 
                        s.id === studentId 
                            ? { ...s, badgesEarned: updatedBadges }
                            : s
                    ));
                    
                    toast.showToast(`Badge "${badgeName}" asignado a ${student.fullName}`, 'success');
                } catch (error) {
                    console.error('Error asignando badge:', error);
                    toast.showToast('Error asignando badge', 'error');
                }
            };

            const handleLogout = async () => {
                try {
                    await auth.signOut();
                    toast.showToast('¡Hasta luego!', 'success');
                } catch (err) {
                    console.error("Error al cerrar sesión:", err);
                    toast.showToast("Error al cerrar sesión. Intenta de nuevo.", 'error');
                }
            };

            const courseWeeks = [
                { week: 1, badge: 'Badge de Iniciación' },
                { week: 2, badge: 'Badge de Brújula Ética' },
                { week: 3, badge: 'Badge de Sembrador de Ideas' },
                { week: 4, badge: 'Badge de Artífice de Preguntas' },
                { week: 5, badge: 'Badge de Bibliotecario Experto' },
                { week: 6, badge: 'Badge de Arquitecto de Proyectos' },
                { week: 7, badge: 'Badge de Navegante Experto' },
                { week: 8, badge: 'Badge de Estratega Metodológico' },
                { week: 9, badge: 'Badge de Constructor de Instrumentos' },
                { week: 10, badge: 'Badge de Recolector de Datos' },
                { week: 11, badge: 'Badge de Intérprete Cualitativo' },
                { week: 12, badge: 'Badge de Analista Cuantitativo' },
                { week: 13, badge: 'Badge de Descubridor de Patrones' },
                { week: 14, badge: 'Badge de Narrador Visual' },
                { week: 15, badge: 'Badge de Comunicador Maestro' },
                { week: 16, badge: 'Badge de Investigador Élite' }
            ];

            return React.createElement('div', { className: 'min-h-screen p-4 md:p-8', style: { backgroundColor: 'var(--bg-primary)' } }, [
                React.createElement('header', {
                    key: 'header',
                    className: 'card rounded-xl p-6 mb-8 animate-fadeIn'
                }, [
                    React.createElement('div', {
                        key: 'header-content',
                        className: 'flex flex-col md:flex-row justify-between items-start md:items-center gap-4'
                    }, [
                        React.createElement('div', { key: 'title-section' }, [
                            React.createElement('h1', { className: 'text-3xl font-bold mb-2' }, 'Panel de Administración'),
                            React.createElement('p', { 
                                className: 'text-sm',
                                style: { color: 'var(--text-secondary)' }
                            }, `Profesor: ${userData?.fullName || currentUser.email}`)
                        ]),
                        React.createElement('div', { key: 'actions', className: 'flex items-center gap-3' }, [
                            React.createElement(ThemeToggle, { key: 'theme' }),
                            React.createElement('button', {
                                key: 'logout',
                                onClick: handleLogout,
                                className: 'btn btn-secondary flex items-center gap-2'
                            }, [React.createElement(LogOut), 'Cerrar Sesión'])
                        ])
                    ])
                ]),
                loading ? React.createElement(LoadingSpinner, { key: 'loading' }) :
                React.createElement('div', { key: 'content', className: 'card rounded-xl p-6' }, [
                    React.createElement('h2', {
                        key: 'students-title',
                        className: 'text-xl font-bold mb-4'
                    }, `Estudiantes Registrados (${students.length})`),
                    React.createElement('div', {
                        key: 'students-list',
                        className: 'space-y-4'
                    }, students.map(student => 
                        React.createElement('div', {
                            key: student.id,
                            className: 'border rounded-lg p-4',
                            style: { borderColor: 'var(--border-color)' }
                        }, [
                            React.createElement('div', {
                                key: 'info',
                                className: 'flex justify-between items-start mb-3'
                            }, [
                                React.createElement('div', { key: 'details' }, [
                                    React.createElement('h3', { className: 'font-semibold' }, student.fullName),
                                    React.createElement('p', {
                                        className: 'text-sm',
                                        style: { color: 'var(--text-secondary)' }
                                    }, student.email)
                                ]),
                                React.createElement('div', {
                                    key: 'progress',
                                    className: 'text-right'
                                }, [
                                    React.createElement('p', { className: 'text-sm font-medium' }, 
                                        `${(student.badgesEarned || []).length}/${courseWeeks.length} badges`
                                    )
                                ])
                            ]),
                            React.createElement('div', {
                                key: 'badges',
                                className: 'grid grid-cols-2 md:grid-cols-4 gap-2'
                            }, courseWeeks.map(week => {
                                const hasEarned = (student.badgesEarned || []).includes(week.badge);
                                const canAssign = !hasEarned;
                                
                                return React.createElement('button', {
                                    key: week.week,
                                    onClick: canAssign ? () => assignBadge(student.id, week.badge) : undefined,
                                    disabled: hasEarned,
                                    className: `text-xs p-2 rounded transition-all ${
                                        hasEarned 
                                            ? 'bg-green-100 text-green-800 cursor-default' 
                                            : 'bg-gray-100 hover:bg-blue-100 text-gray-700 hover:text-blue-800 cursor-pointer'
                                    }`
                                }, [
                                    React.createElement('div', { className: 'font-medium' }, `S${week.week}`),
                                    React.createElement('div', { className: 'truncate' }, week.badge),
                                    hasEarned && React.createElement(CheckCircle, { className: 'inline ml-1' })
                                ]);
                            }))
                        ])
                    ))
                ])
            ]);
        }

        // Componente de la Página del Curso Principal mejorado
        function CoursePage({ firebaseApp, currentUser }) {
            const auth = firebase.auth();
            const db = firebase.firestore();
            const toast = useToast();
            const [userData, setUserData] = React.useState(null);
            const [loadingUserData, setLoadingUserData] = React.useState(true);
            const [error, setError] = React.useState('');

            // Usamos un appId fijo para GitHub Pages
            const appId = 'seminario-investigacion-app'; 

            React.useEffect(() => {
                if (!currentUser) {
                    setLoadingUserData(false);
                    return;
                }

                // Verificar si es profesor y redirigir
                const checkUserType = async () => {
                    try {
                        const userDoc = await db.doc(`artifacts/${appId}/users/${currentUser.uid}`).get();
                        if (userDoc.exists && userDoc.data().userType === 'professor') {
                            // No cargar datos de estudiante para profesores
                            setLoadingUserData(false);
                            return;
                        }
                    } catch (error) {
                        console.error('Error verificando tipo de usuario:', error);
                    }
                };

                checkUserType();

                // Crear datos por defecto si no se pueden cargar desde Firestore
                const defaultUserData = {
                    email: currentUser.email,
                    fullName: currentUser.email.split('@')[0],
                    badgesEarned: [] // Sin badges inicialmente
                };
                
                const userDocRef = db.doc(`artifacts/${appId}/users/${currentUser.uid}`);
                const unsubscribe = userDocRef.onSnapshot((docSnap) => {
                    if (docSnap.exists) {
                        const data = docSnap.data();
                        if (data.userType === 'professor') {
                            setLoadingUserData(false);
                            return;
                        }
                        setUserData(data);
                        setError('');
                    } else {
                        console.warn("No se encontró el documento del usuario en Firestore. Usando datos por defecto.");
                        setUserData(defaultUserData);
                        setError('');
                    }
                    setLoadingUserData(false);
                }, (err) => {
                    console.error("Error al obtener datos del usuario:", err);
                    console.log("Usando datos por defecto debido a error de permisos");
                    setUserData(defaultUserData);
                    setError('');
                    setLoadingUserData(false);
                });

                return () => unsubscribe(); // Limpiar el listener al desmontar
            }, [currentUser, db, appId]);

            const handleLogout = async () => {
                try {
                    await auth.signOut();
                    toast.showToast('¡Hasta luego!', 'success');
                } catch (err) {
                    console.error("Error al cerrar sesión:", err);
                    toast.showToast("Error al cerrar sesión. Intenta de nuevo.", 'error');
                }
            };

            const hasBadge = (badgeName) => userData?.badgesEarned?.includes(badgeName) || false;
            
            // Función para otorgar un badge
            const earnBadge = async (badgeName) => {
                if (hasBadge(badgeName)) {
                    toast.showToast('Ya tienes este badge', 'error');
                    return;
                }
                
                try {
                    const userDocRef = db.doc(`artifacts/${appId}/users/${currentUser.uid}`);
                    const currentBadges = userData?.badgesEarned || [];
                    const newBadges = [...currentBadges, badgeName];
                    
                    await userDocRef.update({
                        badgesEarned: newBadges,
                        lastBadgeEarned: new Date()
                    });
                    
                    toast.showToast(`¡Felicidades! Has obtenido: ${badgeName}`, 'success');
                } catch (error) {
                    console.error('Error al otorgar badge:', error);
                    toast.showToast('Error al otorgar el badge', 'error');
                }
            };

            const courseWeeks = [
                {
                    week: 1,
                    title: 'Misión de Inicio - Descubriendo el Territorio de la Investigación',
                    badge: 'Badge de Iniciación',
                    content: (
                        <>
                            <div className="mb-6">
                                <h4 className="font-bold text-lg mb-3" style={{color: 'var(--accent-color)'}}>📚 Contenido</h4>
                                <ul className="list-disc list-inside ml-4 space-y-2">
                                    <li>Presentación del curso: objetivos, metodología (teórico-práctica, gamificada), sistema de "badges" y evaluación.</li>
                                    <li>Acuerdos sobre el uso ético, crítico y transparente de la Inteligencia Artificial Generativa (IAG) en el curso.</li>
                                    <li>Introducción a la investigación aplicada en diseño, innovación y experiencia de usuario: ¿Por qué investigamos en diseño?</li>
                                    <li>Identificación de los diferentes campos y tipos de investigación desde la disciplina del diseño (investigación para el diseño, a través del diseño, sobre el diseño).</li>
                                </ul>
                            </div>
                            <div className="mb-6">
                                <h4 className="font-bold text-lg mb-3" style={{color: 'var(--accent-color)'}}>🎯 Actividad en Clase (2 horas)</h4>
                                <ul className="list-disc list-inside ml-4 space-y-3">
                                    <li><strong>"Círculo de Expectativas" (15 min):</strong> Cada estudiante comparte qué espera del curso y qué le gustaría investigar.</li>
                                    <li><strong>"Exploración de Casos Inspiradores" (60 min):</strong> Análisis grupal de 2-3 proyectos de investigación en diseño (ej. estudios de usabilidad, investigación de mercado para un nuevo producto, diseño participativo). Discusión guiada: ¿Qué problema abordaron? ¿Qué métodos usaron? ¿Cuál fue su impacto?</li>
                                    <li><strong>"Debate: El Poder de la Pregunta" (30 min):</strong> Discusión sobre la importancia de una buena pregunta de investigación como punto de partida.</li>
                                    <li><strong>Sesión de Preguntas y Respuestas (15 min):</strong> Aclaración de dudas sobre el sílabo y la dinámica del curso.</li>
                                </ul>
                            </div>
                            <div className="mb-6">
                                <h4 className="font-bold text-lg mb-3" style={{color: 'var(--accent-color)'}}>📝 Tarea (Desafío Post-Clase)</h4>
                                <ul className="list-disc list-inside ml-4 space-y-3">
                                    <li><strong>"Primer Paso del Explorador":</strong> Leer la introducción del libro "Metodología de la Investigación" de Sampieri (Capítulo 1: La idea de investigación y el planteamiento del problema).</li>
                                    <li><strong>"Diario del Investigador":</strong> Reflexionar y escribir en un documento personal (o digital) 3 preguntas iniciales que te gustaría responder a través de la investigación en diseño, basándote en tus intereses personales o profesionales.</li>
                                </ul>
                            </div>
                        </>
                    ),
                    isUnlockable: true // Siempre desbloqueada la primera semana
                },
                {
                    week: 2,
                    title: 'Misión de Enfoque - Brújulas Metodológicas y Ética del Explorador',
                    badge: 'Badge de Brújula Ética',
                    content: (
                        <>
                            <div className="mb-6">
                                <h4 className="font-bold text-lg mb-3" style={{color: 'var(--accent-color)'}}>📚 Contenido</h4>
                                <ul className="list-disc list-inside ml-4 space-y-2">
                                    <li><strong>Enfoques de la investigación:</strong> Cuantitativo (medición, estadísticas), Cualitativo (comprensión profunda, narrativas) y Mixto (combinación de ambos).</li>
                                    <li><strong>Rutas metodológicas:</strong> Diseño de experimentos, estudios de caso, encuestas, etnografía, etc.</li>
                                    <li><strong>Principios éticos:</strong> Consentimiento informado, privacidad, anonimato, no maleficencia, justicia.</li>
                                </ul>
                            </div>
                            <div className="mb-6">
                                <h4 className="font-bold text-lg mb-3" style={{color: 'var(--accent-color)'}}>🎯 Actividad en Clase (2 horas)</h4>
                                <ul className="list-disc list-inside ml-4 space-y-3">
                                    <li><strong>"Diferenciando Rutas: Taller de Casos" (75 min):</strong> Los estudiantes, en pequeños grupos, analizarán 3-4 resúmenes de investigaciones (se proporcionarán). Deberán identificar el enfoque principal (cualitativo, cuantitativo, mixto), justificar su elección y proponer una posible ruta metodológica. Presentación y debate grupal.</li>
                                    <li><strong>"El Dilema Ético: Discusión Abierta" (45 min):</strong> Presentación de 2-3 escenarios hipotéticos de investigación en diseño con dilemas éticos. Los estudiantes discutirán en grupos cómo abordarían cada situación de manera ética, aplicando los principios aprendidos.</li>
                                </ul>
                            </div>
                            <div className="mb-6">
                                <h4 className="font-bold text-lg mb-3" style={{color: 'var(--accent-color)'}}>📝 Tarea (Desafío Post-Clase)</h4>
                                <ul className="list-disc list-inside ml-4 space-y-3">
                                    <li><strong>"Análisis de Brújulas":</strong> Leer un artículo de investigación cualitativa y uno cuantitativa en diseño (enlaces proporcionados). Para cada uno, identificar:
                                        <ul className="list-circle list-inside ml-6 mt-2 space-y-1">
                                            <li>El enfoque principal y por qué lo clasificas así</li>
                                            <li>El tipo de datos recolectados</li>
                                            <li>Cómo se abordó (o debería haberse abordado) la ética en el estudio</li>
                                        </ul>
                                    </li>
                                </ul>
                            </div>
                        </>
                    ),
                    isUnlockable: false // Se desbloquea con el badge anterior
                },
                {
                    week: 3,
                    title: 'Misión de Ideación - Sembrando Ideas, Cosechando Problemas',
                    badge: 'Badge de Sembrador de Ideas',
                    content: (
                        <>
                            <p className="font-semibold">Contenido:</p>
                            <ul className="list-disc list-inside ml-4">
                                <li>Cómo surgen las ideas de investigación en el campo del diseño e innovación: observación, tendencias, necesidades no satisfechas, brechas en el conocimiento.</li>
                                <li>Técnicas de problematización: "5 Porqués", Diagrama de Ishikawa (causa-efecto), Árbol de Problemas.</li>
                                <li>Exploración de problemáticas relevantes en el contexto actual del diseño y la sociedad.</li>
                            </ul>
                            <p className="font-semibold mt-4">Actividad en Clase (2 horas):</p>
                            <ul className="list-disc list-inside ml-4">
                                <li>**"Tormenta de Ideas Creativa y Problemática" (60 min):** Los estudiantes, de forma individual o en parejas, usarán la herramienta de **"Generador de Ideas de Investigación ✨"** en la infografía del curso. Cada uno describirá 2-3 intereses amplios (ej. "sostenibilidad en moda", "gamificación en educación", "interfaz para personas mayores"). Luego, la IA generará ideas.</li>
                                <li>**"Taller: Descomponiendo el Problema" (60 min):** Elegirán una de las ideas generadas (o una propia) y aplicarán la técnica de los "5 Porqués" o el Diagrama de Ishikawa para profundizar en la raíz del problema.</li>
                            </ul>
                            <p className="font-semibold mt-4">Tarea (Desafío Post-Clase):</p>
                            <ul className="list-disc list-inside ml-4">
                                <li>**"El Problema del Héroe":** Seleccionar la problemática que más les interese para su proyecto. Realizar una búsqueda preliminar de información (noticias, blogs, informes, redes sociales) para entender el contexto, los actores involucrados y lo que ya se sabe sobre el problema.</li>
                                <li>**"Mapa Mental del Problema":** Crear un mapa mental visual de la problemática elegida, incluyendo causas, efectos, actores y posibles áreas de intervención desde el diseño.</li>
                            </ul>
                        </>
                    ),
                    isUnlockable: false
                },
                {
                    week: 4,
                    title: 'Misión de Precisión - Afinando la Pregunta Correcta',
                    badge: 'Badge de Artífice de Preguntas',
                    content: (
                        <>
                            <p className="font-semibold">Contenido:</p>
                            <ul className="list-disc list-inside ml-4">
                                <li>Análisis de problemas en diversos contextos: identificación de la población, el contexto y el alcance.</li>
                                <li>Delimitación de problemas de investigación: de lo general a lo específico.</li>
                                <li>Formulación de preguntas de investigación: características de una buena pregunta (clara, concisa, factible, relevante, ética). Tipos de preguntas (descriptivas, exploratorias, explicativas, predictivas).</li>
                            </ul>
                            <p className="font-semibold mt-4">Actividad en Clase (2 horas):</p>
                            <ul className="list-disc list-inside ml-4">
                                <li>**"Taller de Preguntas Poderosas" (90 min):** Basándose en su problemática definida, los estudiantes trabajarán en la formulación de al menos 3 preguntas de investigación tentativas. Se utilizará la técnica PICO (Población, Intervención/Exposición, Comparación, Outcome) o PECOT (Población, Exposición, Comparación, Outcome, Tiempo) como guía. Habrá rondas de retroalimentación entre pares y con el profesor para refinar las preguntas.</li>
                                <li>**"El Embudo de la Investigación" (30 min):** Ejercicio práctico para pasar de una idea general a una pregunta de investigación muy específica, enfatizando la delimitación.</li>
                            </ul>
                            <p className="font-semibold mt-4">Tarea (Desafío Post-Clase):</p>
                            <ul className="list-disc list-inside ml-4">
                                <li>**"El Enigma Resuelto":** Redactar el planteamiento del problema (descripción, contexto, justificación de su relevancia) y la pregunta de investigación final para su proyecto. Esta pregunta debe ser el eje central de su futura investigación.</li>
                            </ul>
                        </>
                    ),
                    isUnlockable: false
                },
                {
                    week: 5,
                    title: 'Misión de Fundamentación - Construyendo los Pilares del Conocimiento',
                    badge: 'Badge de Bibliotecario Experto',
                    content: (
                        <>
                            <p className="font-semibold">Contenido:</p>
                            <ul className="list-disc list-inside ml-4">
                                <li>Revisión de literatura científica: importancia, tipos de fuentes (artículos, libros, tesis), bases de datos académicas (Scopus, Google Scholar, Dialnet, etc.).</li>
                                <li>Estrategias de búsqueda sistemática: palabras clave, operadores booleanos, filtros.</li>
                                <li>Gestión de referencias bibliográficas (Mendeley, Zotero, etc. - mención de herramientas).</li>
                                <li>Formulación de objetivos de investigación: objetivos generales (qué se busca lograr) y específicos (pasos para lograr el general). Características SMART.</li>
                            </ul>
                            <p className="font-semibold mt-4">Actividad en Clase (2 horas):</p>
                            <ul className="list-disc list-inside ml-4">
                                <li>**"Cazadores de Conocimiento: Laboratorio de Búsqueda" (75 min):** Los estudiantes, con sus laptops, realizarán búsquedas de literatura en bases de datos académicas relevantes para sus temas. El profesor guiará en el uso de operadores y filtros avanzados.</li>
                                <li>**"Objetivos SMART: Taller de Precisión" (45 min):** Los estudiantes redactarán sus objetivos generales y específicos, asegurándose de que sean SMART y estén directamente alineados con su pregunta de investigación. Retroalimentación en pequeños grupos.</li>
                            </ul>
                            <p className="font-semibold mt-4">Tarea (Desafío Post-Clase):</p>
                            <ul className="list-disc list-inside ml-4">
                                <li>**"La Biblioteca del Investigador":** Realizar una revisión bibliográfica profunda. Identificar y leer al menos 5-7 fuentes clave (artículos de investigación, capítulos de libros) directamente relacionadas con su problemática y pregunta.</li>
                                <li>**"Marco Conceptual Preliminar":** Comenzar a identificar y definir los conceptos clave que emergen de su revisión bibliográfica y que serán fundamentales para su investigación.</li>
                            </ul>
                        </>
                    ),
                    isUnlockable: false
                },
                {
                    week: 6,
                    title: 'Misión de Planificación - El Mapa del Tesoro de tu Proyecto',
                    badge: 'Badge de Arquitecto de Proyectos',
                    content: (
                        <>
                            <p className="font-semibold">Contenido:</p>
                            <ul className="list-disc list-inside ml-4">
                                <li>Justificación de la investigación: ¿Por qué es importante este estudio? Relevancia teórica, práctica, social, metodológica.</li>
                                <li>Alcance y limitaciones del estudio: ¿Qué abarcará y qué no?</li>
                                <li>Estructura de la propuesta de investigación: Introducción, planteamiento del problema, justificación, objetivos, marco conceptual (preliminar), metodología (esquema), cronograma (tentativo), presupuesto (tentativo), referencias.</li>
                            </ul>
                            <p className="font-semibold mt-4">Actividad en Clase (2 horas):</p>
                            <ul className="list-disc list-inside ml-4">
                                <li>**"El Argumento Persuasivo: Taller de Justificación" (60 min):** Los estudiantes trabajarán en la redacción de la justificación de su proyecto, enfocándose en convencer de su relevancia. Ejercicios de "elevator pitch" para sus ideas.</li>
                                <li>**"Presentación Preliminar del Mapa" (60 min):** Cada estudiante (o pareja) realizará una presentación breve (5-7 min) de los avances de su propuesta de investigación (problema, pregunta, objetivos, justificación preliminar, posible alcance). Se fomentará la retroalimentación constructiva entre compañeros.</li>
                            </ul>
                            <p className="font-semibold mt-4">Tarea (Desafío Post-Clase):</p>
                            <ul className="list-disc list-inside ml-4">
                                <li>**"El Borrador del Explorador":** Consolidar el primer borrador completo de la propuesta de investigación, incluyendo todas las secciones discutidas: Introducción, Planteamiento del Problema, Justificación, Objetivos, un Marco Conceptual preliminar y un esquema de la Metodología.</li>
                            </ul>
                        </>
                    ),
                    isUnlockable: false
                },
                {
                    week: 7,
                    title: 'Parcial 1 - El Primer Hito: Presentación de la Propuesta de Investigación (Avance)',
                    badge: 'Badge de Navegante Experto',
                    content: (
                        <>
                            <p className="font-semibold">Contenido:</p>
                            <ul className="list-disc list-inside ml-4">
                                <li>Evaluación formal de los avances en la formulación de la propuesta de investigación.</li>
                            </ul>
                            <p className="font-semibold mt-4">Actividad en Clase (2 horas):</p>
                            <ul className="list-disc list-inside ml-4">
                                <li>**"Defensa del Mapa" (120 min):** Exposiciones individuales (o en pareja) formales de la propuesta de investigación. Cada estudiante tendrá un tiempo asignado para presentar y luego responder preguntas del profesor y compañeros.</li>
                            </ul>
                            <p className="font-semibold mt-4">Tarea (Desafío Post-Clase):</p>
                            <ul className="list-disc list-inside ml-4">
                                <li>**"Refinando el Mapa":** Incorporar la retroalimentación recibida durante el parcial para refinar y fortalecer la propuesta de investigación. Este documento será la base para las siguientes unidades.</li>
                            </ul>
                            <p className="font-semibold mt-4">Rúbrica Parcial 1: Propuesta de Investigación (30% de la nota final)</p>
                            <div className="overflow-x-auto">
                                <table className="min-w-full bg-white border border-gray-200">
                                    <thead>
                                        <tr className="bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                                            <th className="py-3 px-4 border-b">Criterio</th>
                                            <th className="py-3 px-4 border-b">Excelente (5)</th>
                                            <th className="py-3 px-4 border-b">Bueno (4)</th>
                                            <th className="py-3 px-4 border-b">Regular (3)</th>
                                            <th className="py-3 px-4 border-b">Insuficiente (2)</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr><td className="py-2 px-4 border-b">Planteamiento del Problema</td><td className="py-2 px-4 border-b">El problema está claramente definido, contextualizado, su relevancia es convincente y se vincula al diseño/innovación.</td><td className="py-2 px-4 border-b">El problema está definido y contextualizado, pero la relevancia podría ser más fuerte o la conexión con el diseño menos explícita.</td><td className="py-2 px-4 border-b">El problema es identificable, pero le falta claridad, contextualización y/o una conexión clara con el campo de estudio.</td><td className="py-2 px-4 border-b">El problema no está claro, no es relevante o no se relaciona con las disciplinas del curso.</td></tr>
                                        <tr><td className="py-2 px-4 border-b">Pregunta de Investigación</td><td className="py-2 px-4 border-b">La pregunta es clara, concisa, específica, medible, directamente relacionada con el problema y orienta la investigación.</td><td className="py-2 px-4 border-b">La pregunta es clara y relevante, pero podría ser más específica, medible o menos orientadora para la investigación.</td><td className="py-2 px-4 border-b">La pregunta es vaga, ambigua o no se alinea completamente con el problema planteado.</td><td className="py-2 px-4 border-b">La pregunta es confusa, inexistente o no es una pregunta de investigación.</td></tr>
                                        <tr><td className="py-2 px-4 border-b">Objetivos de Investigación</td><td className="py-2 px-4 border-b">Los objetivos generales y específicos son SMART, coherentes con la pregunta y abordan el problema de forma integral.</td><td className="py-2 px-4 border-b">Los objetivos son claros, pero algunos podrían ser más específicos, medibles o no cubren completamente el alcance del problema.</td><td className="py-2 px-4 border-b">Los objetivos son generales, poco claros y/o no están completamente alineados con la pregunta de investigación.</td><td className="py-2 px-4 border-b">Los objetivos son inexistentes, incoherentes o no tienen relación con la investigación propuesta.</td></tr>
                                        <tr><td className="py-2 px-4 border-b">Justificación</td><td className="py-2 px-4 border-b">Demuestra una comprensión profunda de la relevancia del estudio, su contribución teórica, práctica y social.</td><td className="py-2 px-4 border-b">La justificación es adecuada, pero podría profundizar en la contribución del estudio o en su impacto.</td><td className="py-2 px-4 border-b">La justificación es superficial, no logra convencer de la importancia del estudio o es poco argumentada.</td><td className="py-2 px-4 border-b">No hay justificación o la presentada es irrelevante, incorrecta o sin sustento.</td></tr>
                                        <tr><td className="py-2 px-4 border-b">Estructura y Coherencia</td><td className="py-2 px-4 border-b">La propuesta está lógicamente estructurada, con una excelente coherencia y fluidez entre todos sus componentes.</td><td className="py-2 px-4 border-b">La propuesta está bien estructurada, con buena coherencia entre sus partes, aunque con transiciones ocasionales mejorables.</td><td className="py-2 px-4 border-b">La estructura es básica y la coherencia entre los componentes es débil o inconsistente.</td><td className="py-2 px-4 border-b">La propuesta carece de estructura, es desorganizada o incoherente en sus partes.</td></tr>
                                        <tr><td className="py-2 px-4 border-b">Presentación Oral</td><td className="py-2 px-4 border-b">Presentación clara, concisa, segura, con dominio del tema, excelente manejo del tiempo y respuesta efectiva a preguntas.</td><td className="py-2 px-4 border-b">Presentación clara y con buen dominio del tema, aunque podría mejorar el manejo del tiempo o la interacción con preguntas.</td><td className="py-2 px-4 border-b">Presentación con poca claridad, dominio limitado del tema y/o problemas de tiempo.</td><td className="py-2 px-4 border-b">Presentación confusa, sin dominio del tema, incompleta o incapacidad para responder preguntas.</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </>
                    ),
                    isUnlockable: false
                },
                {
                    week: 8,
                    title: 'Misión de Diseño - Creando tu Estrategia de Recolección',
                    badge: 'Badge de Estratega Metodológico',
                    content: (
                        <>
                            <p className="font-semibold">Contenido:</p>
                            <ul className="list-disc list-inside ml-4">
                                <li>Diseño metodológico: Selección del tipo de estudio (exploratorio, descriptivo, correlacional, explicativo).</li>
                                <li>Población y muestra: Definición de los participantes del estudio, criterios de inclusión y exclusión, métodos de muestreo (probabilístico y no probabilístico).</li>
                                <li>Definición de conceptos clave (marco conceptual): Operacionalización de variables y categorías de análisis.</li>
                                <li>Consideraciones sobre la validez y fiabilidad en la recolección de datos.</li>
                            </ul>
                            <p className="font-semibold mt-4">Actividad en Clase (2 horas):</p>
                            <ul className="list-disc list-inside ml-4">
                                <li>**"El Laboratorio Metodológico" (90 min):** En grupos, los estudiantes trabajarán en el diseño detallado de la metodología para su proyecto. Deberán definir el tipo de estudio, la población, el tamaño y tipo de muestra, y cómo operacionalizarán sus conceptos clave. El profesor proporcionará ejemplos y guiará la discusión.</li>
                                <li>**"Debate: ¿Cuántos y Quiénes?" (30 min):** Discusión sobre los desafíos de definir la población y muestra en proyectos de diseño (ej. estudios con usuarios, pruebas de usabilidad).</li>
                            </ul>
                            <p className="font-semibold mt-4">Tarea (Desafío Post-Clase):</p>
                            <ul className="list-disc list-inside ml-4">
                                <li>**"El Arsenal del Investigador":** Profundizar en el marco conceptual, definiendo claramente los conceptos principales de su investigación.</li>
                                <li>**"Esquema Metodológico Detallado":** Desarrollar el esquema de su metodología, incluyendo: tipo de estudio, población objetivo, criterios de selección de la muestra, y una primera idea de las técnicas de recolección de datos que utilizarán.</li>
                            </ul>
                        </>
                    ),
                    isUnlockable: false
                },
                {
                    week: 9,
                    title: 'Misión de Herramientas - Construyendo tus Instrumentos',
                    badge: 'Badge de Constructor de Instrumentos',
                    content: (
                        <>
                            <p className="font-semibold">Contenido:</p>
                            <ul className="list-disc list-inside ml-4">
                                <li>Técnicas e instrumentos de recolección de datos cualitativos: Entrevistas (estructuradas, semi-estructuradas, no estructuradas), grupos focales, observación (participante, no participante), diarios de campo, análisis de contenido.</li>
                                <li>Técnicas e instrumentos de recolección de datos cuantitativos: Encuestas (diseño de preguntas, escalas de medición), experimentos (variables, grupos de control), pruebas de usabilidad (métricas).</li>
                                <li>Diseño de instrumentos: Redacción de preguntas, estructura, validación (piloto).</li>
                            </ul>
                            <p className="font-semibold mt-4">Actividad en Clase (2 horas):</p>
                            <ul className="list-disc list-inside ml-4">
                                <li>**"Caja de Herramientas del Investigador: Taller de Diseño de Instrumentos" (90 min):** Los estudiantes, en sus grupos de proyecto, comenzarán a diseñar los borradores de sus instrumentos de recolección de datos (ej. guion de entrevista, cuestionario de encuesta, protocolo de observación para una prueba de usabilidad). Se realizarán ejercicios de "role-play" o pruebas rápidas entre compañeros para recibir retroalimentación inicial.</li>
                                <li>**"Mini-Simulación de Recolección" (30 min):** Breve ejercicio práctico de aplicación de un fragmento de instrumento (ej. una serie de 3 preguntas de entrevista o un mini-cuestionario) para experimentar el proceso.</li>
                            </ul>
                            <p className="font-semibold mt-4">Tarea (Desafío Post-Clase):</p>
                            <ul className="list-disc list-inside ml-4">
                                <li>**"El Kit de Recolección":** Desarrollar los borradores completos de los instrumentos de recolección de datos para su proyecto. Deben estar listos para una prueba piloto.</li>
                            </ul>
                        </>
                    ),
                    isUnlockable: false
                },
                {
                    week: 10,
                    title: 'Misión de Campo - Recolectando los Datos (¡La Aventura Comienza!)',
                    badge: 'Badge de Recolector de Datos',
                    content: (
                        <>
                            <p className="font-semibold">Contenido:</p>
                            <ul className="list-disc list-inside ml-4">
                                <li>Ejecución de la recolección de datos: Preparación logística, gestión de participantes, ética en la práctica.</li>
                                <li>Organización de datos cualitativos: Transcripción de entrevistas, sistematización de observaciones.</li>
                                <li>Organización de datos cuantitativos: Creación de bases de datos (hojas de cálculo), codificación de respuestas.</li>
                                <li>Manejo de imprevistos durante la recolección.</li>
                            </ul>
                            <p className="font-semibold mt-4">Actividad en Clase (2 horas):</p>
                            <ul className="list-disc list-inside ml-4">
                                <li>**"Expedición de Datos: Desafíos y Soluciones" (60 min):** Discusión sobre los desafíos comunes en la recolección de datos (ej. baja participación, sesgos, problemas técnicos). Se presentarán casos de estudio y estrategias para superarlos.</li>
                                <li>**"Taller: Organizando el Tesoro" (60 min):** Los estudiantes trabajarán en la organización de una pequeña muestra de datos (simulados o reales si ya han avanzado) en el formato adecuado para su análisis (ej. tabla para datos cuantitativos, transcripción para cualitativos).</li>
                            </ul>
                            <p className="font-semibold mt-4">Tarea (Desafío Post-Clase):</p>
                            <ul className="list-disc list-inside ml-4">
                                <li>**"El Diario del Explorador":** Iniciar la recolección de datos para el proyecto (si es factible y éticamente aprobado, con un grupo pequeño de prueba; si no, simular la recolección y organizar datos ficticios realistas). Documentar el proceso, los desafíos encontrados y las decisiones tomadas.</li>
                                <li>**"Base de Datos Preliminar":** Organizar los datos recolectados (o simulados) en una estructura adecuada para el análisis.</li>
                            </ul>
                        </>
                    ),
                    isUnlockable: false
                },
                {
                    week: 11,
                    title: 'Misión de Descifrado - Análisis Cualitativo',
                    badge: 'Badge de Intérprete Cualitativo',
                    content: (
                        <>
                            <p className="font-semibold">Contenido:</p>
                            <ul className="list-disc list-inside ml-4">
                                <li>Introducción al análisis de datos cualitativos: el proceso interpretativo.</li>
                                <li>Técnicas de análisis cualitativo: Codificación (abierta, axial, selectiva), análisis temático, análisis de contenido, análisis de discurso.</li>
                                <li>Herramientas para el análisis cualitativo (mención de software como Atlas.ti, NVivo, o métodos manuales con hojas de cálculo).</li>
                                <li>Interpretación de resultados cualitativos: Construcción de narrativas y significados.</li>
                            </ul>
                            <p className="font-semibold mt-4">Actividad en Clase (2 horas):</p>
                            <ul className="list-disc list-inside ml-4">
                                <li>**"El Detective Cualitativo: Taller de Codificación" (90 min):** Los estudiantes trabajarán con un fragmento de datos cualitativos (ej. transcripción de una entrevista simulada o real). Aplicarán técnicas de codificación abierta y axial para identificar categorías y temas emergentes.</li>
                                <li>**"Discusión: Historias que los Datos Cuentan" (30 min):** Compartir los primeros temas identificados y discutir cómo las narrativas cualitativas aportan a la comprensión del problema.</li>
                            </ul>
                            <p className="font-semibold mt-4">Tarea (Desafío Post-Clase):</p>
                            <ul className="list-disc list-inside ml-4">
                                <li>**"Primeros Hallazgos Cualitativos":** Realizar el análisis preliminar de los datos cualitativos recolectados para su proyecto. Identificar al menos 3-5 temas o categorías emergentes clave que respondan a su pregunta de investigación.</li>
                            </ul>
                        </>
                    ),
                    isUnlockable: false
                },
                {
                    week: 12,
                    title: 'Misión de Cuantificación - Análisis Cuantitativo',
                    badge: 'Badge de Analista Cuantitativo',
                    content: (
                        <>
                            <p className="font-semibold">Contenido:</p>
                            <ul className="list-disc list-inside ml-4">
                                <li>Introducción al análisis de datos cuantitativos: estadísticas descriptivas (frecuencias, promedios, desviación estándar, moda, mediana).</li>
                                <li>Estadísticas inferenciales básicas (correlación, comparación de medias - conceptos generales).</li>
                                <li>Herramientas para el análisis cuantitativo (Excel, Google Sheets, SPSS, R - mención de herramientas).</li>
                                <li>Interpretación de resultados cuantitativos: Identificación de patrones, tendencias y relaciones.</li>
                            </ul>
                            <p className="font-semibold mt-4">Actividad en Clase (2 horas):</p>
                            <ul className="list-disc list-inside ml-4">
                                <li>**"El Mago de los Números: Taller de Análisis Descriptivo" (90 min):** Los estudiantes trabajarán con una pequeña base de datos cuantitativos (simulados o reales). Calcularán estadísticas descriptivas y generarán gráficos básicos (barras, torta, líneas) para visualizar sus datos.</li>
                                <li>**"Debate: ¿Qué Nos Dicen los Números?" (30 min):** Discusión sobre cómo los datos cuantitativos complementan o contrastan con los cualitativos en la investigación en diseño.</li>
                            </ul>
                            <p className="font-semibold mt-4">Tarea (Desafío Post-Clase):</p>
                            <ul className="list-disc list-inside ml-4">
                                <li>**"Primeros Hallazgos Cuantitativos":** Realizar el análisis preliminar de los datos cuantitativos recolectados para su proyecto. Generar al menos 3-5 gráficos o tablas que muestren sus hallazgos más interesantes y relevantes para su pregunta de investigación.</li>
                            </ul>
                        </>
                    ),
                    isUnlockable: false
                },
                {
                    week: 13,
                    title: 'Parcial 2 - El Segundo Hito: Presentación de Resultados de Análisis Preliminar',
                    badge: 'Badge de Descubridor de Patrones',
                    content: (
                        <>
                            <p className="font-semibold">Contenido:</p>
                            <ul className="list-disc list-inside ml-4">
                                <li>Evaluación formal de la capacidad para analizar datos cualitativos y cuantitativos, y de la interpretación inicial de los resultados.</li>
                            </ul>
                            <p className="font-semibold mt-4">Actividad en Clase (2 horas):</p>
                            <ul className="list-disc list-inside ml-4">
                                <li>**"El Relato de los Datos" (120 min):** Cada estudiante (o pareja) presentará los análisis preliminares de sus datos (cualitativos y/o cuantitativos). Deberán mostrar sus hallazgos más relevantes, explicar cómo los analizaron y discutir las primeras interpretaciones y las conexiones con su pregunta de investigación.</li>
                            </ul>
                            <p className="font-semibold mt-4">Tarea (Desafío Post-Clase):</p>
                            <ul className="list-disc list-inside ml-4">
                                <li>**"Las Primeras Conclusiones":** Elaborar conclusiones argumentadas basadas en los resultados preliminares, conectándolas con los objetivos de investigación y la pregunta planteada. Identificar nuevas preguntas o áreas de profundización.</li>
                            </ul>
                            <p className="font-semibold mt-4">Rúbrica Parcial 2: Análisis Preliminar de Datos (30% de la nota final)</p>
                            <div className="overflow-x-auto">
                                <table className="min-w-full bg-white border border-gray-200">
                                    <thead>
                                        <tr className="bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                                            <th className="py-3 px-4 border-b">Criterio</th>
                                            <th className="py-3 px-4 border-b">Excelente (5)</th>
                                            <th className="py-3 px-4 border-b">Bueno (4)</th>
                                            <th className="py-3 px-4 border-b">Regular (3)</th>
                                            <th className="py-3 px-4 border-b">Insuficiente (2)</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr><td className="py-2 px-4 border-b">Organización y Preparación de Datos</td><td className="py-2 px-4 border-b">Datos cualitativos y cuantitativos organizados de forma impecable, lógica y listos para el análisis.</td><td className="py-2 px-4 border-b">Datos bien organizados, con algunas áreas menores de mejora en la estructura o preparación.</td><td className="py-2 px-4 border-b">Datos con organización básica, pero con inconsistencias o dificultades para el análisis efectivo.</td><td className="py-2 px-4 border-b">Datos desorganizados, incompletos o incorrectos, imposibilitando el análisis.</td></tr>
                                        <tr><td className="py-2 px-4 border-b">Análisis Cualitativo (si aplica)</td><td className="py-2 px-4 border-b">Aplicación rigurosa y correcta de técnicas de codificación y análisis temático, identificando patrones y significados profundos.</td><td className="py-2 px-4 border-b">Buen análisis cualitativo, identificando temas relevantes, aunque podría profundizar en la interpretación o la conexión entre códigos.</td><td className="py-2 px-4 border-b">Análisis cualitativo superficial, con temas poco desarrollados, códigos inconsistentes o conexiones débiles.</td><td className="py-2 px-4 border-b">No se realizó análisis cualitativo, es incorrecto o no se basa en los datos.</td></tr>
                                        <tr><td className="py-2 px-4 border-b">Análisis Cuantitativo (si aplica)</td><td className="py-2 px-4 border-b">Aplicación correcta de técnicas descriptivas e inferenciales básicas, con interpretación clara y precisa de los resultados.</td><td className="py-2 px-4 border-b">Buen análisis cuantitativo, con resultados claros, aunque la interpretación podría ser más profunda o las técnicas más variadas.</td><td className="py-2 px-4 border-b">Análisis cuantitativo básico, con errores en la aplicación de técnicas o interpretación limitada/incorrecta.</td><td className="py-2 px-4 border-b">No se realizó análisis cuantitativo, es incorrecto o no se basa en los datos.</td></tr>
                                        <tr><td className="py-2 px-4 border-b">Conexión con Objetivos y Pregunta</td><td className="py-2 px-4 border-b">Los análisis están directamente vinculados con los objetivos de investigación, respondiendo de forma clara a la pregunta planteada.</td><td className="py-2 px-4 border-b">Los análisis se relacionan con los objetivos, pero la conexión podría ser más explícita o directa con la pregunta.</td><td className="py-2 px-4 border-b">La conexión entre los análisis y los objetivos/pregunta es débil, inconsistente o poco clara.</td><td className="py-2 px-4 border-b">Los análisis no tienen relación con los objetivos o la pregunta de investigación.</td></tr>
                                        <tr><td className="py-2 px-4 border-b">Interpretación y Conclusiones Preliminares</td><td className="py-2 px-4 border-b">Interpretaciones profundas, críticas y conclusiones preliminares argumentadas, basadas sólidamente en la evidencia de los datos.</td><td className="py-2 px-4 border-b">Interpretaciones adecuadas y conclusiones preliminares, aunque podrían ser más robustas o menos superficiales.</td><td className="py-2 px-4 border-b">Interpretaciones superficiales y conclusiones poco argumentadas, sin sustento claro en los datos o con inferencias incorrectas.</td><td className="py-2 px-4 border-b">No hay interpretaciones o conclusiones, o son incorrectas/irrelevantes.</td></tr>
                                        <tr><td className="py-2 px-4 border-b">Presentación Oral</td><td className="py-2 px-4 border-b">Presentación clara, concisa, con visualización efectiva de resultados, dominio del tema y excelente manejo del tiempo.</td><td className="py-2 px-4 border-b">Presentación clara, con buena visualización, aunque podría mejorar el manejo del tiempo o la fluidez.</td><td className="py-2 px-4 border-b">Presentación con poca claridad, visualización deficiente de resultados y/o problemas de tiempo.</td><td className="py-2 px-4 border-b">Presentación confusa, sin resultados claros o incompleta.</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </>
                    ),
                    isUnlockable: false
                },
                {
                    week: 14,
                    title: 'Misión de Narrativa - Contando tu Historia con Datos',
                    badge: 'Badge de Narrador Visual',
                    content: (
                        <>
                            <p className="font-semibold">Contenido:</p>
                            <ul className="list-disc list-inside ml-4">
                                <li>Principios de visualización de datos: Claridad, precisión, integridad, estética. Tipos de gráficos adecuados para diferentes tipos de datos y mensajes.</li>
                                <li>Herramientas de visualización (Chart.js, Plotly.js - conceptos básicos).</li>
                                <li>Estructura del informe final de investigación: Introducción, Marco Teórico, Metodología, Resultados, Discusión, Conclusiones, Recomendaciones, Referencias.</li>
                                <li>Redacción académica y estilo.</li>
                            </ul>
                            <p className="font-semibold mt-4">Actividad en Clase (2 horas):</p>
                            <ul className="list-disc list-inside ml-4">
                                <li>**"El Artista de Datos: Taller de Visualización" (90 min):** Los estudiantes trabajarán en la creación de visualizaciones impactantes para sus resultados (ej. infografías, gráficos avanzados). Se revisarán ejemplos de buenas y malas prácticas en visualización.</li>
                                <li>**"Construyendo el Esqueleto del Informe" (30 min):** Discusión sobre la estructura del informe final, asignando secciones y responsabilidades (si es un trabajo en equipo).</li>
                            </ul>
                            <p className="font-semibold mt-4">Tarea (Desafío Post-Clase):</p>
                            <ul className="list-disc list-inside ml-4">
                                <li>**"El Primer Capítulo":** Empezar a redactar el informe final de investigación, prestando especial atención a la sección de Resultados. Asegurarse de que los hallazgos estén bien presentados y explicados, con el apoyo de las visualizaciones creadas.</li>
                            </ul>
                        </>
                    ),
                    isUnlockable: false
                },
                {
                    week: 15,
                    title: 'Misión de Impacto - Preparando tu Gran Revelación',
                    badge: 'Badge de Comunicador Maestro',
                    content: (
                        <>
                            <p className="font-semibold">Contenido:</p>
                            <ul className="list-disc list-inside ml-4">
                                <li>Comunicación efectiva de resultados de investigación: Adaptación del mensaje a la audiencia, claridad y concisión.</li>
                                <li>Diseño de presentaciones orales: Estructura, ayudas visuales, manejo del tiempo, técnicas de oratoria.</li>
                                <li>Consideraciones éticas en la comunicación de resultados: No distorsionar datos, reconocer limitaciones, citar fuentes.</li>
                                <li>Preparación para la defensa del proyecto.</li>
                            </ul>
                            <p className="font-semibold mt-4">Actividad en Clase (2 horas):</p>
                            <ul className="list-disc list-inside ml-4">
                                <li>**"El Escenario del Investigador: Ensayo General" (120 min):** Cada estudiante (o pareja) realizará un ensayo de su presentación oral del proyecto final. Se cronometrará el tiempo y se proporcionará retroalimentación detallada sobre el contenido, la claridad, las ayudas visuales y la oratoria.</li>
                            </ul>
                            <p className="font-semibold mt-4">Tarea (Desafío Post-Clase):</p>
                            <ul className="list-disc list-inside ml-4">
                                <li>**"La Obra Maestra":** Finalizar el informe de investigación, asegurando que todos los componentes estén completos, pulidos y coherentes.</li>
                                <li>**"El Discurso Final":** Preparar la presentación oral final, ensayando hasta dominar el contenido y el tiempo.</li>
                            </ul>
                        </>
                    ),
                    isUnlockable: false
                },
                {
                    week: 16,
                    title: 'Parcial 3 - La Gran Final: Entrega Final de Proyecto Aplicado',
                    badge: 'Badge de Investigador Élite',
                    content: (
                        <>
                            <p className="font-semibold">Contenido:</p>
                            <ul className="list-disc list-inside ml-4">
                                <li>Presentación y defensa formal del proyecto de investigación aplicado.</li>
                            </ul>
                            <p className="font-semibold mt-4">Actividad en Clase (2 horas):</p>
                            <ul className="list-disc list-inside ml-4">
                                <li>**"La Defensa del Proyecto" (120 min):** Presentación y defensa de los proyectos finales de investigación ante el profesor y compañeros. Cada equipo/estudiante tendrá un tiempo asignado para su presentación y una sesión de preguntas y respuestas.</li>
                            </ul>
                            <p className="font-semibold mt-4">Rúbrica Parcial 3: Entrega Final de Proyecto Aplicado (40% de la nota final)</p>
                            <div className="overflow-x-auto">
                                <table className="min-w-full bg-white border border-gray-200">
                                    <thead>
                                        <tr className="bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                                            <th className="py-3 px-4 border-b">Criterio</th>
                                            <th className="py-3 px-4 border-b">Excelente (5)</th>
                                            <th className="py-3 px-4 border-b">Bueno (4)</th>
                                            <th className="py-3 px-4 border-b">Regular (3)</th>
                                            <th className="py-3 px-4 border-b">Insuficiente (2)</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr><td className="py-2 px-4 border-b">Calidad del Informe Final</td><td className="py-2 px-4 border-b">Informe completo, bien estructurado, claro, conciso, con redacción impecable, formato profesional y referencias adecuadas.</td><td className="py-2 px-4 border-b">Informe completo y estructurado, con buena redacción, aunque con algunos detalles menores a pulir en formato o estilo.</td><td className="py-2 px-4 border-b">Informe con algunas secciones incompletas o poco claras, y/o con errores de redacción/formato significativos.</td><td className="py-2 px-4 border-b">Informe incompleto, desorganizado, con graves deficiencias de redacción o formato, o sin referencias.</td></tr>
                                        <tr><td className="py-2 px-4 border-b">Coherencia y Argumentación del Proyecto</td><td className="py-2 px-4 border-b">Coherencia total y explícita entre problema, objetivos, marco teórico, metodología, resultados y conclusiones. Argumentación sólida y basada en evidencia.</td><td className="py-2 px-4 border-b">Buena coherencia y argumentación, aunque algunos puntos podrían ser más robustos o la conexión más explícita.</td><td className="py-2 px-4 border-b">Coherencia limitada entre los componentes y/o argumentación débil, con algunas inconsistencias.</td><td className="py-2 px-4 border-b">Falta de coherencia y argumentación, o argumentos sin sustento en la investigación.</td></tr>
                                        <tr><td className="py-2 px-4 border-b">Análisis y Presentación de Resultados</td><td className="py-2 px-4 border-b">Análisis exhaustivo y profundo de datos cualitativos y cuantitativos. Presentación clara, efectiva y visualmente impactante de resultados.</td><td className="py-2 px-4 border-b">Análisis adecuado y presentación clara de resultados, con visualizaciones funcionales y comprensibles.</td><td className="py-2 px-4 border-b">Análisis superficial o incompleto. Resultados presentados de forma confusa o con visualizaciones deficientes/incorrectas.</td><td className="py-2 px-4 border-b">No hay análisis de datos o los resultados son incomprensibles, irrelevantes o no presentados.</td></tr>
                                        <tr><td className="py-2 px-4 border-b">Discusión y Conclusiones</td><td className="py-2 px-4 border-b">Discusión crítica de los hallazgos, conectándolos con la literatura y el contexto. Conclusiones claras, concisas, con implicaciones prácticas/teóricas y recomendaciones.</td><td className="py-2 px-4 border-b">Discusión y conclusiones adecuadas, aunque podrían ser más profundas, críticas o tener mayores implicaciones.</td><td className="py-2 px-4 border-b">Discusión superficial o conclusiones vagas, sin conexión clara con los hallazgos o sin recomendaciones pertinentes.</td><td className="py-2 px-4 border-b">No hay discusión o conclusiones, o son incorrectas/irrelevantes.</td></tr>
                                        <tr><td className="py-2 px-4 border-b">Contribución al Campo</td><td className="py-2 px-4 border-b">El proyecto demuestra una contribución significativa, original y relevante a la comprensión de problemáticas en diseño, innovación o UX.</td><td className="py-2 px-4 border-b">El proyecto realiza una contribución relevante al campo, aunque no necesariamente original o con un impacto limitado.</td><td className="py-2 px-4 border-b">La contribución del proyecto es limitada, poco clara o no se alinea bien con las disciplinas del curso.</td><td className="py-2 px-4 border-b">El proyecto no demuestra una contribución al campo o es irrelevante.</td></tr>
                                        <tr><td className="py-2 px-4 border-b">Presentación Oral y Defensa</td><td className="py-2 px-4 border-b">Presentación excepcional, dominio total del tema, capacidad para responder preguntas de forma crítica, reflexiva y persuasiva.</td><td className="py-2 px-4 border-b">Presentación muy buena, buen dominio del tema y capacidad para responder la mayoría de las preguntas de forma adecuada.</td><td className="py-2 px-4 border-b">Presentación con debilidades (claridad, tiempo, visuales), dominio limitado del tema y dificultades para responder preguntas.</td><td className="py-2 px-4 border-b">Presentación deficiente, sin dominio del tema, incompleta o incapacidad para defender el proyecto.</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </>
                    ),
                    isUnlockable: false
                }
            ];

            if (loadingUserData) {
                return <LoadingSpinner />;
            }

            if (error) {
                return (
                    <div className="min-h-screen flex items-center justify-center" style={{backgroundColor: 'var(--bg-primary)'}}>
                        <div className="card rounded-xl p-8 text-center animate-fadeIn">
                            <p style={{color: 'var(--error-color)'}} className="text-lg font-semibold">{error}</p>
                            <button 
                                onClick={() => window.location.reload()} 
                                className="btn btn-primary mt-4"
                            >
                                Reintentar
                            </button>
                        </div>
                    </div>
                );
            }

            const studentName = userData?.fullName || currentUser?.email.split('@')[0];
            const studentEmailDisplay = userData?.email || currentUser?.email;
            const earnedBadges = userData?.badgesEarned || [];
            const completedWeeks = earnedBadges.length;

            return (
                <div className="min-h-screen p-4 md:p-8" style={{backgroundColor: 'var(--bg-primary)'}}>
                    <header className="card rounded-xl p-6 mb-8 animate-fadeIn">
                        <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                            <div className="flex-1">
                                <h1 className="text-3xl font-bold mb-2" style={{color: 'var(--text-primary)'}}>
                                    Seminario de Investigación
                                </h1>
                                <div className="flex items-center gap-2 text-sm" style={{color: 'var(--text-secondary)'}}>
                                    <User />
                                    <span>Hola, <strong>{studentName}</strong> ({studentEmailDisplay})</span>
                                </div>
                                <div className="mt-3">
                                    <ProgressBar current={completedWeeks} total={courseWeeks.length} />
                                </div>
                            </div>
                            <div className="flex items-center gap-3">
                                <ThemeToggle />
                                <button
                                    onClick={handleLogout}
                                    className="btn btn-secondary flex items-center gap-2"
                                    title="Cerrar sesión"
                                >
                                    <LogOut />
                                    <span className="hidden md:inline">Cerrar Sesión</span>
                                </button>
                            </div>
                        </div>
                    </header>

                    <main className="container mx-auto max-w-6xl">
                        <BadgesDashboard 
                            courseWeeks={courseWeeks} 
                            userData={userData} 
                            onEarnBadge={earnBadge}
                        />
                        
                        <div className="mb-8">
                            <h2 className="text-3xl font-bold text-center mb-2" style={{color: 'var(--text-primary)'}}>
                                Tu Aventura Semanal
                            </h2>
                            <p className="text-center" style={{color: 'var(--text-secondary)'}}>
                                Completa cada semana para desbloquear la siguiente y obtener badges
                            </p>
                        </div>
                        
                        <div className="space-y-6">
                            {courseWeeks.map((weekData, index) => {
                                const previousBadge = index > 0 ? courseWeeks[index - 1].badge : null;
                                const isUnlocked = weekData.week === 1 || hasBadge(previousBadge);
                                const hasCurrentBadge = hasBadge(weekData.badge);

                                return (
                                    <CourseWeek
                                        key={weekData.week}
                                        weekNumber={weekData.week}
                                        title={weekData.title}
                                        content={weekData.content}
                                        badgeName={weekData.badge}
                                        isUnlocked={isUnlocked}
                                        hasBadge={hasCurrentBadge}
                                    />
                                );
                            })}
                        </div>
                    </main>
                </div>
            );
        }

        // Componente principal de la aplicación React
        function App() {
            const [firebaseApp, setFirebaseApp] = React.useState(null);
            const [auth, setAuth] = React.useState(null);
            const [currentUser, setCurrentUser] = React.useState(null);
            const [userData, setUserData] = React.useState(null);
            const [authReady, setAuthReady] = React.useState(false);
            const [firebaseConfigLoaded, setFirebaseConfigLoaded] = React.useState(false);
            const [userDataLoaded, setUserDataLoaded] = React.useState(false);

            // Configuración de Firebase desde variables de entorno o archivo externo
            const firebaseConfig = window.FIREBASE_CONFIG || {
                // Configuración por defecto vacía - debe ser configurada externamente
                apiKey: "",
                authDomain: "",
                projectId: "",
                storageBucket: "",
                messagingSenderId: "",
                appId: ""
            };

            React.useEffect(() => {
                if (firebaseConfig.apiKey && !firebaseApp) {
                    console.log('Inicializando Firebase...');
                    const app = firebase.initializeApp(firebaseConfig);
                    setFirebaseApp(app);
                    const authInstance = firebase.auth();
                    setAuth(authInstance);
                    setFirebaseConfigLoaded(true);
                } else if (!firebaseConfig.apiKey) {
                    console.error("Firebase config no está completa. Por favor, rellena los placeholders.");
                    setAuthReady(true);
                }
            }, [firebaseApp, firebaseConfig.apiKey]);
            
            // useEffect separado para el listener de autenticación
            React.useEffect(() => {
                if (auth) {
                    console.log('Configurando listener de autenticación...');
                    const unsubscribe = auth.onAuthStateChanged(async (user) => {
                        console.log('Estado de autenticación cambió:', user ? `Usuario logueado: ${user.uid}` : 'Usuario no logueado');
                        setCurrentUser(user);
                        
                        if (user) {
                            // Cargar datos del usuario para determinar el tipo
                            try {
                                const db = firebase.firestore();
                                const userDoc = await db.doc(`artifacts/seminario-investigacion-app/users/${user.uid}`).get();
                                if (userDoc.exists) {
                                    setUserData(userDoc.data());
                                } else {
                                    setUserData(null);
                                }
                            } catch (error) {
                                console.error('Error cargando datos del usuario:', error);
                                setUserData(null);
                            }
                        } else {
                            setUserData(null);
                        }
                        
                        setUserDataLoaded(true);
                        setAuthReady(true);
                    });
                    
                    return () => {
                        console.log('Limpiando listener de autenticación');
                        unsubscribe();
                    };
                }
            }, [auth]);

            if (!firebaseConfigLoaded || !authReady || (currentUser && !userDataLoaded)) {
                return <LoadingSpinner />;
            }

            console.log('Estado actual - currentUser:', currentUser ? 'Logueado' : 'No logueado');
            console.log('Tipo de usuario:', userData?.userType || 'No definido');

            return (
                <ToastProvider>
                    <AuthContext.Provider value={{ firebaseApp, currentUser, userData }}>
                        {currentUser ? (
                            userData?.userType === 'professor' ? (
                                <AdminDashboard currentUser={currentUser} />
                            ) : (
                                <CoursePage firebaseApp={firebaseApp} currentUser={currentUser} />
                            )
                        ) : (
                            <AuthPage firebaseApp={firebaseApp} />
                        )}
                    </AuthContext.Provider>
                </ToastProvider>
            );
        }

        // Montar la aplicación React en el div con id "root" usando React 18
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
