<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seminario de Investigaci√≥n</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #f9fafb;
            --bg-secondary: #ffffff;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --border-color: #e5e7eb;
            --accent-color: #4D96FF;
            --success-color: #10b981;
            --error-color: #ef4444;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        [data-theme="dark"] {
            --bg-primary: #111827;
            --bg-secondary: #1f2937;
            --text-primary: #f9fafb;
            --text-secondary: #d1d5db;
            --border-color: #374151;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.3), 0 1px 2px 0 rgba(0, 0, 0, 0.2);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2);
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        .spinner {
            border: 4px solid rgba(77, 150, 255, 0.2);
            border-left-color: var(--accent-color);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @keyframes slideDown {
            from { opacity: 0; max-height: 0; }
            to { opacity: 1; max-height: 1000px; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-slideDown { animation: slideDown 0.3s ease-out; }
        .animate-fadeIn { animation: fadeIn 0.5s ease-out; }
        
        .card {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }
        
        .card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }
        
        .progress-bar {
            background-color: var(--border-color);
            border-radius: 9999px;
            overflow: hidden;
        }
        
        .progress-fill {
            background: linear-gradient(90deg, var(--accent-color), var(--success-color));
            height: 100%;
            border-radius: 9999px;
            transition: width 0.5s ease;
        }
        
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        
        .badge-earned {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }
        
        .badge-pending {
            background-color: rgba(107, 114, 128, 0.1);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }
        
        .input-field {
            background-color: var(--bg-secondary);
            border: 2px solid var(--border-color);
            color: var(--text-primary);
            transition: all 0.2s ease;
        }
        
        .input-field:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(77, 150, 255, 0.1);
        }
        
        .input-field.error {
            border-color: var(--error-color);
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
        }
        
        .input-field.success {
            border-color: var(--success-color);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            font-weight: 600;
            transition: all 0.2s ease;
            cursor: pointer;
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--accent-color), #3b82f6);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-secondary {
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
        }
        
        .btn-secondary:hover {
            border-color: var(--accent-color);
            color: var(--accent-color);
        }
        
        .theme-toggle {
            background-color: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 9999px;
            padding: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .theme-toggle:hover {
            border-color: var(--accent-color);
        }
        
        .toast {
            position: fixed;
            top: 1rem;
            right: 1rem;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            color: white;
            font-weight: 600;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }
        
        .toast-success { background-color: var(--success-color); }
        .toast-error { background-color: var(--error-color); }
        
        .chevron {
            transition: transform 0.3s ease;
            display: inline-block;
        }
        
        .chevron.rotate-90 {
            transform: rotate(90deg);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const ToastContext = React.createContext();
        
        function ToastProvider({ children }) {
            const [toasts, setToasts] = React.useState([]);
            
            const showToast = (message, type = 'success') => {
                const id = Date.now();
                setToasts(prev => [...prev, { id, message, type }]);
                setTimeout(() => {
                    setToasts(prev => prev.filter(toast => toast.id !== id));
                }, 3000);
            };
            
            return React.createElement(ToastContext.Provider, { value: { showToast } }, [
                children,
                React.createElement('div', { key: 'toasts' }, 
                    toasts.map(toast => 
                        React.createElement('div', {
                            key: toast.id,
                            className: `toast toast-${toast.type}`
                        }, toast.message)
                    )
                )
            ]);
        }
        
        const useToast = () => React.useContext(ToastContext);
        
        function useTheme() {
            const [theme, setTheme] = React.useState(() => 
                localStorage.getItem('theme') || 'light'
            );
            
            React.useEffect(() => {
                document.documentElement.setAttribute('data-theme', theme);
                localStorage.setItem('theme', theme);
            }, [theme]);
            
            const toggleTheme = () => {
                setTheme(prev => prev === 'light' ? 'dark' : 'light');
            };
            
            return { theme, toggleTheme };
        }
        
        function ThemeToggle() {
            const { theme, toggleTheme } = useTheme();
            return React.createElement('button', {
                className: 'theme-toggle',
                onClick: toggleTheme,
                title: `Cambiar a tema ${theme === 'light' ? 'oscuro' : 'claro'}`
            }, theme === 'light' ? 'üåô' : '‚òÄÔ∏è');
        }
        
        const Lock = ({ className = '' }) => React.createElement('span', { className }, 'üîí');
        const User = ({ className = '' }) => React.createElement('span', { className }, 'üë§');
        const LogOut = ({ className = '' }) => React.createElement('span', { className }, 'üö™');
        const Loader2 = ({ className = '' }) => React.createElement('div', { className: `spinner ${className}` });
        const CheckCircle = ({ className = '' }) => React.createElement('span', { className }, '‚úÖ');
        const Award = ({ className = '' }) => React.createElement('span', { className }, 'üèÜ');
        const Eye = ({ className = '' }) => React.createElement('span', { className }, 'üëÅ');
        const EyeOff = ({ className = '' }) => React.createElement('span', { className }, 'üôà');

        const LoadingSpinner = () => (
          <div className="flex justify-center items-center py-8 animate-fadeIn">
            <div className="spinner"></div>
            <p className="ml-3" style={{color: 'var(--text-secondary)'}}>Cargando...</p>
          </div>
        );
        
        function AuthPage({ firebaseApp }) {
            const toast = useToast();
            const auth = firebase.auth();
            const db = firebase.firestore();
            const [isLogin, setIsLogin] = React.useState(true);
            const [email, setEmail] = React.useState('');
            const [password, setPassword] = React.useState('');
            const [fullName, setFullName] = React.useState('');
            const [loading, setLoading] = React.useState(false);
            const [showCodeVerification, setShowCodeVerification] = React.useState(false);
            const [verificationCode, setVerificationCode] = React.useState('');
            const [generatedCode, setGeneratedCode] = React.useState('');
            const [pendingUserData, setPendingUserData] = React.useState(null);
            const [userRole, setUserRole] = React.useState('student');
            const [courseCode, setCourseCode] = React.useState('');
            
            const validateEmail = (email) => {
                const icesiBothPattern = /^[a-zA-Z0-9._%+-]+@(icesi\.edu\.co|u\.icesi\.edu\.co)$/;
                return icesiBothPattern.test(email);
            };

            const generateCode = () => Math.floor(100000 + Math.random() * 900000).toString();

            const sendVerificationEmail = async (email, code, fullName) => {
                try {
                    // Inicializar EmailJS
                    emailjs.init('145MnHTSSDkBVKZAU');
                    
                    const templateParams = {
                        to_name: fullName || email.split('@')[0],
                        to_email: email,
                        verification_code: code,
                        from_name: 'Seminario de Investigaci√≥n'
                    };
                    
                    console.log('Enviando email con par√°metros:', templateParams);
                    
                    const result = await emailjs.send(
                        'service_7u1zcni',
                        'template_1129sv3',
                        templateParams
                    );
                    
                    console.log('Email enviado exitosamente:', result);
                    toast.showToast('C√≥digo enviado a tu correo', 'success');
                } catch (error) {
                    console.error('Error enviando email:', error);
                    console.log(`C√≥digo de verificaci√≥n para ${email}: ${code}`);
                    toast.showToast(`Error enviando email. C√≥digo (desarrollo): ${code}`, 'error');
                }
            };

            const handleAuth = async (e) => {
                e.preventDefault();
                setLoading(true);

                if (!validateEmail(email)) {
                    toast.showToast('Usa tu correo institucional (@icesi.edu.co o @u.icesi.edu.co)', 'error');
                    setLoading(false);
                    return;
                }

                try {
                    if (isLogin) {
                        const result = await auth.signInWithEmailAndPassword(email, password);
                        toast.showToast('¬°Bienvenido de vuelta!', 'success');
                    } else {
                        // Generar c√≥digo y guardar datos temporalmente
                        const code = generateCode();
                        setGeneratedCode(code);
                        
                        // Validar c√≥digo de curso
                        if (userRole === 'student' && !courseCode.startsWith('#')) {
                            toast.showToast('Los estudiantes deben ingresar un c√≥digo de curso v√°lido (#codigo)', 'error');
                            setLoading(false);
                            return;
                        }
                        
                        if (userRole === 'professor' && !courseCode.startsWith('#')) {
                            toast.showToast('Los profesores deben crear un c√≥digo de curso (#codigo)', 'error');
                            setLoading(false);
                            return;
                        }
                        
                        // Para estudiantes, verificar que el c√≥digo existe
                        if (userRole === 'student') {
                            const courseQuery = await db.collection('artifacts/seminario-investigacion-app/courses')
                                .where('courseCode', '==', courseCode)
                                .get();
                            
                            if (courseQuery.empty) {
                                toast.showToast('C√≥digo de curso no v√°lido. Verifica con tu profesor.', 'error');
                                setLoading(false);
                                return;
                            }
                        }
                        
                        setPendingUserData({
                            email,
                            password,
                            fullName,
                            userType: userRole,
                            courseCode
                        });
                        
                        // Enviar c√≥digo por email
                        await sendVerificationEmail(email, code, fullName);
                        
                        setShowCodeVerification(true);
                    }
                } catch (err) {
                    let errorMessage;
                    switch (err.code) {
                        case 'auth/invalid-email':
                            errorMessage = 'El correo electr√≥nico no tiene un formato v√°lido.';
                            break;
                        case 'auth/user-not-found':
                            errorMessage = 'Usuario no encontrado. Verifica tu correo o crea una cuenta.';
                            break;
                        case 'auth/wrong-password':
                            errorMessage = 'Contrase√±a incorrecta.';
                            break;
                        case 'auth/email-already-in-use':
                            errorMessage = 'Este correo ya est√° registrado.';
                            break;
                        case 'auth/weak-password':
                            errorMessage = 'La contrase√±a es demasiado d√©bil. Debe tener al menos 6 caracteres.';
                            break;
                        default:
                            errorMessage = 'Error de autenticaci√≥n. Por favor, intenta de nuevo.';
                    }
                    toast.showToast(errorMessage, 'error');
                } finally {
                    setLoading(false);
                }
            };

            const handleVerifyCode = async (e) => {
                e.preventDefault();
                setLoading(true);

                if (verificationCode !== generatedCode) {
                    toast.showToast('C√≥digo incorrecto', 'error');
                    setLoading(false);
                    return;
                }

                try {
                    // Crear usuario en Firebase Auth
                    const userCredential = await auth.createUserWithEmailAndPassword(
                        pendingUserData.email,
                        pendingUserData.password
                    );
                    const user = userCredential.user;
                    
                    // Crear documento en Firestore
                    const appId = 'seminario-investigacion-app';
                    const userDocRef = db.doc(`artifacts/${appId}/users/${user.uid}`);
                    
                    const userData = {
                        email: pendingUserData.email,
                        fullName: pendingUserData.fullName,
                        userType: pendingUserData.userType,
                        emailVerified: true,
                        createdAt: new Date()
                    };

                    if (pendingUserData.userType === 'student') {
                        userData.badgesEarned = [];
                        userData.lastBadgeEarned = null;
                        userData.courseCode = pendingUserData.courseCode;
                    } else {
                        userData.courseCode = pendingUserData.courseCode;
                        
                        // Crear documento del curso si es profesor
                        const courseDocRef = db.collection('artifacts/seminario-investigacion-app/courses').doc();
                        await courseDocRef.set({
                            courseCode: pendingUserData.courseCode,
                            professorId: user.uid,
                            professorEmail: pendingUserData.email,
                            professorName: pendingUserData.fullName,
                            createdAt: new Date(),
                            studentsCount: 0
                        });
                    }
                    
                    await userDocRef.set(userData);
                    
                    toast.showToast('¬°Cuenta creada exitosamente! Bienvenido.', 'success');
                    
                    // Limpiar estados
                    setShowCodeVerification(false);
                    setVerificationCode('');
                    setGeneratedCode('');
                    setPendingUserData(null);
                } catch (err) {
                    console.error('Error creando cuenta:', err);
                    toast.showToast('Error creando la cuenta', 'error');
                } finally {
                    setLoading(false);
                }
            };

            if (showCodeVerification) {
                return (
                    <div className="min-h-screen flex items-center justify-center p-4" style={{backgroundColor: 'var(--bg-primary)'}}>
                        <div className="card rounded-2xl p-8 w-full max-w-md animate-fadeIn">
                            <div className="flex justify-between items-center mb-6">
                                <h2 className="text-3xl font-bold" style={{color: 'var(--text-primary)'}}>
                                    Verificar C√≥digo
                                </h2>
                                <ThemeToggle />
                            </div>
                            
                            <div className="text-center mb-6">
                                <p className="text-sm" style={{color: 'var(--text-secondary)'}}>
                                    Ingresa el c√≥digo de 6 d√≠gitos enviado a <strong>{pendingUserData?.email}</strong>
                                </p>
                            </div>
                            
                            <form onSubmit={handleVerifyCode}>
                                <div className="mb-6">
                                    <input
                                        className="input-field w-full py-3 px-4 rounded-lg focus:outline-none text-center text-2xl tracking-widest"
                                        type="text"
                                        placeholder="000000"
                                        value={verificationCode}
                                        onChange={(e) => setVerificationCode(e.target.value.replace(/\D/g, '').slice(0, 6))}
                                        maxLength="6"
                                        required
                                    />
                                </div>
                                
                                <div className="flex flex-col gap-4">
                                    <button
                                        className="btn btn-primary w-full"
                                        type="submit"
                                        disabled={loading || verificationCode.length !== 6}
                                    >
                                        {loading && <Loader2 className="w-5 h-5" />}
                                        Verificar y Crear Cuenta
                                    </button>
                                    
                                    <button
                                        className="btn btn-secondary w-full"
                                        type="button"
                                        onClick={() => {
                                            setShowCodeVerification(false);
                                            setVerificationCode('');
                                            setGeneratedCode('');
                                            setPendingUserData(null);
                                        }}
                                    >
                                        Volver
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen flex items-center justify-center p-4" style={{backgroundColor: 'var(--bg-primary)'}}>
                    <div className="card rounded-2xl p-8 w-full max-w-md animate-fadeIn">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-3xl font-bold" style={{color: 'var(--text-primary)'}}>
                                {isLogin ? 'Iniciar Sesi√≥n' : 'Crear Cuenta'}
                            </h2>
                            <ThemeToggle />
                        </div>
                        
                        <form onSubmit={handleAuth}>
                            <div className="mb-4">
                                <label className="block text-sm font-bold mb-2" style={{color: 'var(--text-primary)'}}>
                                    Correo Institucional
                                </label>
                                <input
                                    className="input-field w-full py-3 px-4 rounded-lg focus:outline-none"
                                    type="email"
                                    placeholder="correo@icesi.edu.co o @u.icesi.edu.co"
                                    value={email}
                                    onChange={(e) => setEmail(e.target.value)}
                                    required
                                />
                            </div>
                            
                            {!isLogin && (
                                <>
                                    <div className="mb-4">
                                        <label className="block text-sm font-bold mb-2" style={{color: 'var(--text-primary)'}}>
                                            Nombre Completo
                                        </label>
                                        <input
                                            className="input-field w-full py-3 px-4 rounded-lg focus:outline-none"
                                            type="text"
                                            placeholder="Tu Nombre Completo"
                                            value={fullName}
                                            onChange={(e) => setFullName(e.target.value)}
                                            required
                                        />
                                    </div>
                                    
                                    <div className="mb-4">
                                        <label className="block text-sm font-bold mb-2" style={{color: 'var(--text-primary)'}}>
                                            Tipo de Usuario
                                        </label>
                                        <select
                                            className="input-field w-full py-3 px-4 rounded-lg focus:outline-none"
                                            value={userRole}
                                            onChange={(e) => setUserRole(e.target.value)}
                                            required
                                        >
                                            <option value="student">Estudiante</option>
                                            <option value="professor">Profesor</option>
                                        </select>
                                    </div>
                                    
                                    <div className="mb-4">
                                        <label className="block text-sm font-bold mb-2" style={{color: 'var(--text-primary)'}}>
                                            {userRole === 'professor' ? 'Crear C√≥digo de Curso' : 'C√≥digo de Curso'}
                                        </label>
                                        <input
                                            className="input-field w-full py-3 px-4 rounded-lg focus:outline-none"
                                            type="text"
                                            placeholder={userRole === 'professor' ? '#MI_CURSO_2024' : '#codigo_del_profesor'}
                                            value={courseCode}
                                            onChange={(e) => {
                                                let value = e.target.value;
                                                if (value && !value.startsWith('#')) {
                                                    value = '#' + value;
                                                }
                                                setCourseCode(value);
                                            }}
                                            required
                                        />
                                        <p className="text-xs mt-1" style={{color: 'var(--text-secondary)'}}>
                                            {userRole === 'professor' 
                                                ? 'Crea un c√≥digo √∫nico para tu curso (ej: #SEMINARIO_2024)'
                                                : 'Ingresa el c√≥digo que te proporcion√≥ tu profesor'
                                            }
                                        </p>
                                    </div>
                                </>
                            )}
                            
                            <div className="mb-4">
                                <label className="block text-sm font-bold mb-2" style={{color: 'var(--text-primary)'}}>
                                    Contrase√±a
                                </label>
                                <input
                                    className="input-field w-full py-3 px-4 rounded-lg focus:outline-none"
                                    type="password"
                                    placeholder="M√≠nimo 6 caracteres"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    required
                                />
                            </div>
                            
                            <div className="flex flex-col gap-4 mt-6">
                                <button
                                    className="btn btn-primary w-full"
                                    type="submit"
                                    disabled={loading}
                                >
                                    {loading && <Loader2 className="w-5 h-5" />}
                                    {isLogin ? 'Iniciar Sesi√≥n' : 'Enviar C√≥digo'}
                                </button>
                                
                                <button
                                    className="btn btn-secondary w-full"
                                    type="button"
                                    onClick={() => {
                                        setIsLogin(!isLogin);
                                        setEmail('');
                                        setPassword('');
                                        setFullName('');
                                        setUserRole('student');
                                        setCourseCode('');
                                    }}
                                >
                                    {isLogin ? '¬øNo tienes cuenta? Reg√≠strate' : '¬øYa tienes cuenta? Inicia Sesi√≥n'}
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }

        function AdminDashboard({ currentUser }) {
            const auth = firebase.auth();
            const toast = useToast();

            const handleLogout = async () => {
                try {
                    await auth.signOut();
                    toast.showToast('¬°Hasta luego!', 'success');
                } catch (err) {
                    toast.showToast("Error al cerrar sesi√≥n. Intenta de nuevo.", 'error');
                }
            };

            return React.createElement('div', { className: 'min-h-screen p-4 md:p-8', style: { backgroundColor: 'var(--bg-primary)' } }, [
                React.createElement('header', {
                    key: 'header',
                    className: 'card rounded-xl p-6 mb-8 animate-fadeIn'
                }, [
                    React.createElement('div', {
                        key: 'header-content',
                        className: 'flex flex-col md:flex-row justify-between items-start md:items-center gap-4'
                    }, [
                        React.createElement('div', { key: 'title-section' }, [
                            React.createElement('h1', { className: 'text-3xl font-bold mb-2' }, 'Panel de Administraci√≥n'),
                            React.createElement('p', { 
                                className: 'text-sm',
                                style: { color: 'var(--text-secondary)' }
                            }, `Profesor: ${currentUser.email}`)
                        ]),
                        React.createElement('div', { key: 'actions', className: 'flex items-center gap-3' }, [
                            React.createElement(ThemeToggle, { key: 'theme' }),
                            React.createElement('button', {
                                key: 'logout',
                                onClick: handleLogout,
                                className: 'btn btn-secondary flex items-center gap-2'
                            }, [React.createElement(LogOut), 'Cerrar Sesi√≥n'])
                        ])
                    ])
                ]),
                React.createElement('div', { key: 'content', className: 'card rounded-xl p-6' }, [
                    React.createElement('h2', {
                        key: 'title',
                        className: 'text-xl font-bold mb-4'
                    }, 'Panel de Profesor'),
                    React.createElement('p', {
                        key: 'description'
                    }, 'Funcionalidades de administraci√≥n en desarrollo...')
                ])
            ]);
        }

        function CoursePage({ currentUser }) {
            const auth = firebase.auth();
            const toast = useToast();

            const handleLogout = async () => {
                try {
                    await auth.signOut();
                    toast.showToast('¬°Hasta luego!', 'success');
                } catch (err) {
                    toast.showToast("Error al cerrar sesi√≥n. Intenta de nuevo.", 'error');
                }
            };

            return (
                <div className="min-h-screen p-4 md:p-8" style={{backgroundColor: 'var(--bg-primary)'}}>
                    <header className="card rounded-xl p-6 mb-8 animate-fadeIn">
                        <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                            <div className="flex-1">
                                <h1 className="text-3xl font-bold mb-2" style={{color: 'var(--text-primary)'}}>
                                    Seminario de Investigaci√≥n
                                </h1>
                                <div className="flex items-center gap-2 text-sm" style={{color: 'var(--text-secondary)'}}>
                                    <User />
                                    <span>Hola, <strong>{currentUser.email.split('@')[0]}</strong> ({currentUser.email})</span>
                                </div>
                            </div>
                            <div className="flex items-center gap-3">
                                <ThemeToggle />
                                <button
                                    onClick={handleLogout}
                                    className="btn btn-secondary flex items-center gap-2"
                                    title="Cerrar sesi√≥n"
                                >
                                    <LogOut />
                                    <span className="hidden md:inline">Cerrar Sesi√≥n</span>
                                </button>
                            </div>
                        </div>
                    </header>

                    <main className="container mx-auto max-w-6xl">
                        <div className="card rounded-xl p-6">
                            <h2 className="text-xl font-bold mb-4">Bienvenido al curso</h2>
                            <p>Contenido del curso en desarrollo...</p>
                        </div>
                    </main>
                </div>
            );
        }

        function AppContent() {
            const [currentUser, setCurrentUser] = React.useState(null);
            const [userData, setUserData] = React.useState(null);
            const [authReady, setAuthReady] = React.useState(false);
            const toast = useToast();

            const firebaseConfig = {
                apiKey: "AIzaSyBEKzy25wj-qIVJcyqkCors2b8zPostu7E",
                authDomain: "seminario-de-investigaci-283c8.firebaseapp.com",
                projectId: "seminario-de-investigaci-283c8",
                storageBucket: "seminario-de-investigaci-283c8.firebasestorage.app",
                messagingSenderId: "253114435967",
                appId: "1:253114435967:web:b83b9413f663f283b7724a",
                measurementId: "G-7J76P5D7Z3"
            };

            React.useEffect(() => {
                firebase.initializeApp(firebaseConfig);
                const auth = firebase.auth();
                
                // Limpiar URL si hay par√°metros de verificaci√≥n
                const urlParams = new URLSearchParams(window.location.search);
                if (urlParams.has('mode') || urlParams.has('oobCode')) {
                    window.history.replaceState({}, document.title, window.location.pathname);
                }
                
                const unsubscribe = auth.onAuthStateChanged(async (user) => {
                    setCurrentUser(user);
                    
                    if (user) {
                        try {
                            const db = firebase.firestore();
                            const userDoc = await db.doc(`artifacts/seminario-investigacion-app/users/${user.uid}`).get();
                            if (userDoc.exists) {
                                setUserData(userDoc.data());
                            }
                        } catch (error) {
                            console.error('Error cargando datos del usuario:', error);
                        }
                    } else {
                        setUserData(null);
                    }
                    
                    setAuthReady(true);
                });
                
                return () => unsubscribe();
            }, []);

            if (!authReady) {
                return <LoadingSpinner />;
            }

            return (
                <>
                    {currentUser ? (
                        userData?.userType === 'professor' ? (
                            <AdminDashboard currentUser={currentUser} />
                        ) : (
                            <CoursePage currentUser={currentUser} />
                        )
                    ) : (
                        <AuthPage />
                    )}
                </>
            );
        }
        
        function App() {
            return (
                <ToastProvider>
                    <AppContent />
                </ToastProvider>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>